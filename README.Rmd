---
output: github_document
bibliography: Dissonance_Santiago_v3/mybibfile.bib
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Do Drivers Dream of Walking? An Investigation of Travel Mode Dissonance from the Perspective of Affective Values

<!-- badges: start -->
<!-- badges: end -->

Beatriz Mella Lira (Pontificia Universidad Católica de Chile)  
Antonio Paez (McMaster University)  

Journal of Transport and Health (2021), https://doi.org/xx.xxx

## Abstract
  
### Introduction  

Subjective wellbeing is a topic that has attracted considerable attention in the transportation literature in recent years. As a result, there is a burgeoning literature that investigates the impacts of travel on subjective wellbeing, and how wellbeing, in turn, can influence behavior. An important aspect of subjective wellbeing are the affective reactions of people to their experiences.  

### Objective  

The objective of this paper is to analyze the affective reactions of travelers with respect to various modes of transportation. In particular, we are interested in the potential for dissonance between primary mode of travel and the mode(s) of travel identified as evoking various affective reactions.  
   
### Materials and Methods  

The study is based on data collected from a sample of travelers in the city of Santiago, in Chile. Participants in the study were asked about their usual mode of travel, and then were asked to name their ideal mode(s) of transportation from the perspective of various affective reactions. The reactions we investigate are associated with the values of Freedom, Enjoyment, Happiness, Poverty, Luxury, and Status. Analysis is based on tests of independence and visualization techniques.  

### Results  

The results indicate that users of public transportation experience the most dissonance in terms of affective reactions, and active travelers the least. For those travelers who experience dissonance, active travel is the mode most commonly associated with Freedom, Enjoyment, and Happiness, while public transportation is most commonly associated with Poverty. The automobile, in contrast, is the mode most commonly associated with Luxury and Status.

## Keywords

- Mode of travel  
- Subjective wellbeing  
- Dissonance  
- Affective values  
- Santiago de Chile  
- Survey  
- Data analysis  

```{r load-packages, include=FALSE}

# Load packages used in this document
library(ggmosaic)
library(ggthemes)
library(grid)
library(gridExtra)
library(kableExtra)
library(readxl)
library(rgdal)
library(rticles)
library(sf)
library(tidyverse)
```

```{r install-data-package, include=FALSE}
# Run only once if needed
#devtools::install_github("paezha/Mode-Dissonance-and-Subjective-Wellbeing", subdir = "ModeDissonanceSantiago")
```

```{r load-data-package, include=FALSE}
library(ModeDissonanceSantiago)
```

```{r load-data, include=FALSE}

# To run this notebook, the file `Dissonance_Santiago.RData` is needed. This file contains the following object:
# 
# master: a dataframe with information collected from 451 respondents. The variables in the dataframe are:
# 
# - NUMERO: Respondent ID
# - USED: Main mode of transportation used by the respondent
# - FREEDOM: Mode(s) that the respondent associates with feelings of freedom
# - ENJOYMENT: Mode(s) that the respondent associates with feelings of enjoyment
# - HAPPINESS: Mode(s) that the respondent associates with feelings of happiness
# - POVERTY: Mode(s) that the respondent associates with feelings of poverty
# - LUXURY: Mode(s) that the respondent associates with feelings of luxury
# - STATUS: Mode(s) that the respondent associates with feelings of status
# - SAFETY: Mode(s) that the respondent associates with feelings of safety
# - TIME: Mode(s) that the respondent associates with feelings of WASTED TIME
# - EFFICIENCY: Mode(s) that the respondent associates with feelings of efficiency
# - AGE: Age of the respondent
# - EDUCATION: Level of education of the respondent
# - INCOME: Level of income of respondent
# - TRAVEL_TIME: Trip duration of regular commuting trip 
# - WEIGHT_*: A weight for the responses by ATTRIBUTE. Some respondents selected more than one mode that they associated with feelings of {FREEDOM, ENJOYMENT, HAPPINESS, POVERTY, LUXURY, STATUS, SAFETY, TIME, and EFFICIENCY}. To avoid giving greater weight to respondents who indicated several modes of transportation, a weight was calculated that is the inverse of the number of modes indicated. These weights can be used to weight the frequencies prior to any analysis.
# 
# The modes of transportation (USED, FREEDOM, ENJOYMENT, HAPPINESS, POVERTY, LUXURY, STATUS, SAFETY, TIME, EFFICIENCY) are coded as: 
# "A": Car
# "B": Taxi
# "C": Colectivo
# "D": Moto
# "E": Metro
# "F": Bus
# "G": Bicycle
# "H": Walk
#
# AGE is coded as:
#
# "A": Less18
# "B": 18to24
# "C": 25to34
# "D": 35to54
# "E": 55to64
# "F": 65more
# 
# EDUCATION is coded as:
# 
# "A": ELEMENTARY
# "B": SECUNDARY
# "C": PROFESS_TECH
# "D": COLLEGE
# "E": POSTGRAD
#
# INCOME is coded as (in pesos?):
# 
# "A": Less423
# "B": 423to639
# "C": 639to977
# "D": 977to1550
# "E": 1550to2380
# "F": 2380more
# 
# TRAVEL_TIME is coded as:
#
# "A": 0-20 min
# "B": 20-40 min
# "C": 40-60 min
# "D": 1h and more

# Read the RData file:

#load("Dissonance_Santiago_v3/Dissonance_Santiago.RData")
```

```{r data-preparation, include=FALSE}

# The master dataframe is processed for analysis. We plan to conduct two distinct types of analysis:
#
# 1. Who experiences dissonace?
#
# Analysis of dissonance using the characteristics of respondents (i.e., AGE, EDUCATION, INCOME, (Mode) USED, and TRAVEL_TIME) by ATTRIBUTE (i.e., FREEDOM et al.). In this case, dissonance is defined as follows:
#
# >> If the mode used is identical to the mode that the respondent associates with ATTRIBUTE (i.e. FREEDOM et al.), we consider that there is no dissonance; otherwise, we consider that there is dissonance. For example, if the respondent's main mode of transportation is Car, and the respondent associates Car with feelings of FREEDOM, then there is no dissonance. On the other hand, if the respondent's main mode of transportation is Car, but associates Walking with feelings of FREEDOM, there is dissonance.
# 
# Given this, we will calculate how frequently there is dissonance at different levels of AGE, EDUCATION, INCOME, MODE, TRAVEL_TIME. Tests of independence can be implemented.
#
# 2. For those respondents who experience dissonance, what mode(s) are better aligned with various affective values
#
# Analysis of dissonance using the mode USED and the mode respondents associated with ATTRIBUTE, then stratified by characteristics of respondents (i.e., AGE et al.) in this case, we see how frequently each mode was associated with ATTRIBUTE, given the main mode of transportation of the respondents.
#
# Here the dataframes are prepared to support these two types of analysis

#####################################################################################
# Prepare a dataframe for Analysis 1: Who experiences dissonance by affective value #
#####################################################################################

# First, select the variables needed from the master table, and code dissonance as 1 (no dissonance) or two (dissonance):

Overall_dissonance <- Dissonance_Santiago %>%
  transmute(USED, 
            FREEDOM_DISSONANCE = ifelse(USED == FREEDOM, 1, 2),
            ENJOYMENT_DISSONANCE = ifelse(USED == ENJOYMENT, 1, 2),
            HAPPINESS_DISSONANCE = ifelse(USED == HAPPINESS, 1, 2),
            POVERTY_DISSONANCE = ifelse(USED == POVERTY, 1, 2),
            LUXURY_DISSONANCE = ifelse(USED == LUXURY, 1, 2),
            STATUS_DISSONANCE = ifelse(USED == STATUS, 1, 2),
            SAFETY_DISSONANCE = ifelse(USED == SAFETY, 1, 2),
            TIME_DISSONANCE = ifelse(USED == TIME, 1, 2),
            EFFICIENCY_DISSONANCE = ifelse(USED == EFFICIENCY, 1, 2),
            AGE,
            EDUCATION,
            INCOME,
            TRAVEL_TIME)

# Recode variables and convert to factors:

Overall_dissonance <- Overall_dissonance %>%
  mutate(USED = case_when(USED == "A" ~ "Car",
                          USED == "B" | USED == "C" | USED == "D" ~ "Other",
                          USED == "E" | USED == "F" ~ "Public",
                          USED == "G" | USED == "H" ~ "Active"),
         AGE = case_when(AGE == "A" | AGE == "B" | AGE == "C" ~ "< 35",
                         AGE == "D" ~ "35 - 54",
                         AGE == "E" | AGE == "F" ~ "> 54"),
         EDUCATION = case_when(EDUCATION == "A" | EDUCATION == "B" ~ "K-12",
                               EDUCATION == "C" | EDUCATION == "D" ~ "Tech/Univ",
                               EDUCATION == "E" ~ "Graduate"),
         INCOME = case_when(INCOME == "A" | INCOME == "B" ~ "Low",
                            INCOME == "C" | INCOME == "D" ~ "Middle",
                            INCOME == "E" | INCOME == "F" ~ "High"),
         TRAVEL_TIME = case_when(TRAVEL_TIME == "A" ~ "< 20 min",
                                 TRAVEL_TIME == "B" ~ "20 - 40 min",
                                 TRAVEL_TIME == "C" ~ "40 - 60 min",
                                 TRAVEL_TIME == "D" ~ "> 60 min")) %>%
  mutate(USED = factor(USED, levels = c("Car", "Active", "Public", "Other"), labels = c("Car", "Active", "Public", "Other")),
         FREEDOM_DISSONANCE = factor(FREEDOM_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         ENJOYMENT_DISSONANCE = factor(ENJOYMENT_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         HAPPINESS_DISSONANCE = factor(HAPPINESS_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         POVERTY_DISSONANCE = factor(POVERTY_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         LUXURY_DISSONANCE = factor(LUXURY_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         STATUS_DISSONANCE = factor(STATUS_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         SAFETY_DISSONANCE = factor(SAFETY_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         TIME_DISSONANCE = factor(TIME_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         EFFICIENCY_DISSONANCE = factor(EFFICIENCY_DISSONANCE, levels = c(1, 2), labels = c("No Dissonance", "Dissonance")),
         AGE = factor(AGE, levels = c("< 35", "35 - 54", "> 54"), labels = c("< 35", "35 - 54", "> 54")),
         EDUCATION = factor(EDUCATION, levels = c("K-12", "Tech/Univ", "Graduate"), labels = c("K-12", "Tech/Univ", "Graduate")),
         INCOME = factor(INCOME, levels = c("Low", "Middle", "High"), labels = c("Low", "Middle", "High")),
         TRAVEL_TIME = factor(TRAVEL_TIME, levels = c("< 20 min", "20 - 40 min", "40 - 60 min", "> 60 min"), labels = c("< 20 min", "20 - 40 min", "40 - 60 min", "> 60 min")))

###############################################################################################
# Prepare a dataframe for Analysis 2: What mode(s) align better with various affective values #
###############################################################################################

# First, split the responses regarding the modes associated with each attribute, so that we can record each mode selected individually:

Modes_by_Attribute <- Dissonance_Santiago %>% 
  mutate(FREEDOM = strsplit(as.character(FREEDOM), ""),
         ENJOYMENT = strsplit(as.character(ENJOYMENT), ""),
         HAPPINESS = strsplit(as.character(HAPPINESS), ""),
         POVERTY = strsplit(as.character(POVERTY), ""),
         LUXURY = strsplit(as.character(LUXURY), ""),
         STATUS = strsplit(as.character(STATUS), ""),
         SAFETY = strsplit(as.character(SAFETY), ""),
         TIME = strsplit(as.character(TIME), ""),
         EFFICIENCY = strsplit(as.character(EFFICIENCY), ""))

# Here, we convert each of the responses into an individual row and stack the resulting dataframes, after adding the name of the attribute for identification:

Modes_by_Attribute <- rbind(data.frame(Modes_by_Attribute %>% 
                                         select(-c(ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY, 
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY, 
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>% 
                                         rename(IDEAL = FREEDOM, WEIGHT = WEIGHT_FREEDOM) %>%
                                         unnest(IDEAL),
                                       ATTRIBUTE = "FREEDOM"),
                            data.frame(Modes_by_Attribute %>%
                                         select(-c(FREEDOM, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY, 
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY, 
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>% 
                                         rename(IDEAL = ENJOYMENT, WEIGHT = WEIGHT_ENJOYMENT) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "ENJOYMENT"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY, 
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM,
                                                   WEIGHT_ENJOYMENT,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY, 
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>% 
                                         rename(IDEAL = HAPPINESS, WEIGHT = WEIGHT_HAPPINESS) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "HAPPINESS"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY,
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY,
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>%
                                         rename(IDEAL = POVERTY, WEIGHT = WEIGHT_POVERTY) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "POVERTY"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   #LUXURY,
                                                   STATUS,
                                                   SAFETY,
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   #WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY,
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>%
                                         rename(IDEAL = LUXURY, WEIGHT = WEIGHT_LUXURY) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "LUXURY"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   #STATUS,
                                                   SAFETY,
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   #WEIGHT_STATUS,
                                                   WEIGHT_SAFETY,
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>%
                                         rename(IDEAL = STATUS, WEIGHT = WEIGHT_STATUS) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "STATUS"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   TIME, 
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_TIME, 
                                                   WEIGHT_EFFICIENCY)) %>%
                                         rename(IDEAL = SAFETY, WEIGHT = WEIGHT_SAFETY) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "SAFETY"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY,
                                                   EFFICIENCY,
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY,
                                                   WEIGHT_EFFICIENCY)) %>%
                                         rename(IDEAL = TIME, WEIGHT = WEIGHT_TIME) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "TIME"),
                            data.frame(Modes_by_Attribute %>% 
                                         select(-c(FREEDOM, 
                                                   ENJOYMENT, 
                                                   HAPPINESS,
                                                   POVERTY,
                                                   LUXURY,
                                                   STATUS,
                                                   SAFETY,
                                                   TIME, 
                                                   WEIGHT_FREEDOM, 
                                                   WEIGHT_ENJOYMENT, 
                                                   WEIGHT_HAPPINESS,
                                                   WEIGHT_POVERTY,
                                                   WEIGHT_LUXURY,
                                                   WEIGHT_STATUS,
                                                   WEIGHT_SAFETY,
                                                   WEIGHT_TIME)) %>%
                                         rename(IDEAL = EFFICIENCY, WEIGHT = WEIGHT_EFFICIENCY) %>%
                                         unnest(IDEAL), 
                                       ATTRIBUTE = "EFFICIENCY"))

# There are some missing values. Drop all NAs:

Modes_by_Attribute <- drop_na(Modes_by_Attribute)

# We now recode the variables:

Modes_by_Attribute <- Modes_by_Attribute %>%
  mutate(USED = case_when(USED == "A" ~ "Car",
                          USED == "B" | USED == "C" | USED == "D" ~ "Other",
                          USED == "E" | USED == "F" ~ "Public",
                          USED == "G" | USED == "H" ~ "Active"),
         IDEAL = case_when(IDEAL == "A" ~ "Car",
                           IDEAL == "B" | IDEAL == "C" | IDEAL == "D" ~ "Other",
                           IDEAL == "E" | IDEAL == "F" ~ "Public",
                           IDEAL == "G" | IDEAL == "H" ~ "Active"),
         AGE = case_when(AGE == "A" | AGE == "B" | AGE == "C" ~ "< 35",
                         AGE == "D" ~ "35 - 54",
                         AGE == "E" | AGE == "F" ~ "> 54"),
         EDUCATION = case_when(EDUCATION == "A" | EDUCATION == "B" ~ "K-12",
                               EDUCATION == "C" | EDUCATION == "D" ~ "Tech/Univ",
                               EDUCATION == "E" ~ "Graduate"),
         INCOME = case_when(INCOME == "A" | INCOME == "B" ~ "Low",
                            INCOME == "C" | INCOME == "D" ~ "Middle",
                            INCOME == "E" | INCOME == "F" ~ "High"),
         TRAVEL_TIME = case_when(TRAVEL_TIME == "A" ~ "< 20 min",
                                 TRAVEL_TIME == "B" ~ "20 - 40 min",
                                 TRAVEL_TIME == "C" ~ "40 - 60 min",
                                 TRAVEL_TIME == "D" ~ "> 60 min"))

# After recoding the , there will be some duplicate entries, because a person may have attributed, say, feelings of freedom to walking and cycling, so in the table this will appear as two instances of "Active". This is ok, because each is weighted appropriately.

# Convert to factors:

Modes_by_Attribute <- Modes_by_Attribute %>%
  mutate(USED = factor(USED, levels = c("Car", "Active", "Public", "Other"), labels = c("Car", "Active", "Public", "Other")),
         IDEAL = factor(IDEAL, levels = c("Car", "Active", "Public", "Other"), labels = c("Car", "Active", "Public", "Other")),
         AGE = factor(AGE, levels = c("< 35", "35 - 54", "> 54"), labels = c("< 35", "35 - 54", "> 54")),
         EDUCATION = factor(EDUCATION, levels = c("K-12", "Tech/Univ", "Graduate"), labels = c("K-12", "Tech/Univ", "Graduate")),
         INCOME = factor(INCOME, levels = c("Low", "Middle", "High"), labels = c("Low", "Middle", "High")),
         TRAVEL_TIME = factor(TRAVEL_TIME, levels = c("< 20 min", "20 - 40 min", "40 - 60 min", "> 60 min"), labels = c("< 20 min", "20 - 40 min", "40 - 60 min", "> 60 min")))
```

```{r cross-tabs-function, include=FALSE}

## Define functions for crosstabs; these functions enhance the base crosstabs functions and make it easier to report cross tabulations in different ways.

crosstab <- function (..., dec.places = NULL,
                      type = NULL,
                      style = "wide",
                      row.vars = NULL,
                      col.vars = NULL,
                      percentages = TRUE, 
                      addmargins = TRUE,
                      subtotals=TRUE)
  
  ###################################################################################
#                                                                                 #
# Function created by Dr Paul Williamson, Dept. of Geography and Planning,        #
# School of Environmental Sciences, University of Liverpool, UK.                  #
#                                                                                 #
# Adapted from the function ctab() in the catspec package.                         #
#                                                                                 #
# Version: 12th July 2013                                                         #
#                                                                                 #
# Output best viewed using the companion function print.crosstab()                #
#                                                                                 #
###################################################################################


#Declare function used to convert frequency counts into relevant type of proportion or percentage
{mk.pcnt.tbl <- function(tbl, type) {
  a <- length(row.vars)
  b <- length(col.vars)
  mrgn <- switch(type, column.pct = c(row.vars[-a], col.vars), 
                 row.pct = c(row.vars, col.vars[-b]),
                 joint.pct = c(row.vars[-a], col.vars[-b]),
                 total.pct = NULL)
  tbl <- prop.table(tbl, mrgn)
  if (percentages) {
    tbl <- tbl * 100
  }
  tbl
}

#Find no. of vars (all; row; col) for use in subsequent code
n.row.vars <- length(row.vars)
n.col.vars <- length(col.vars)
n.vars <- n.row.vars + n.col.vars


#Check to make sure all user-supplied arguments have valid values
stopifnot(as.integer(dec.places) == dec.places, dec.places > -1)
#type: see next section of code
stopifnot(is.character(style))    
stopifnot(is.logical(percentages))
stopifnot(is.logical(addmargins))
stopifnot(is.logical(subtotals))
stopifnot(n.vars>=1)

#Convert supplied table type(s) into full text string (e.g. "f" becomes "frequency")
#If invalid type supplied, failed match gives user automatic error message
types <- NULL
choices <- c("frequency", "row.pct", "column.pct", "joint.pct", "total.pct")
for (tp in type) types <- c(types, match.arg(tp, choices))
type <- types

#If no type supplied, default to 'frequency + total' for univariate tables and to
#'frequency' for multi-dimensional tables

#For univariate table....
if (n.vars == 1) {
  if (is.null(type)) {
    # default = freq count + total.pct  
    type <- c("frequency", "total.pct")
    #row.vars <- 1
  } else {
    #and any requests for row / col / joint.pct must be changed into requests for 'total.pct'
    type <- ifelse(type == "frequency", "frequency", "total.pct")
  }
  #For multivariate tables...
} else if (is.null(type)) {
  # default = frequency count  
  type <- "frequency"
}



#Check for integrity of requested analysis and adjust values of function arguments as required

if ((addmargins==FALSE) & (subtotals==FALSE)) {
  warning("WARNING: Request to suppress subtotals (subtotals=FALSE) ignored because no margins requested (addmargins=FALSE)")
  subtotals <- TRUE
}

if ((n.vars>1) & (length(type)>1) & (addmargins==TRUE)) {
  warning("WARNING: Only row totals added when more than one table type requested")
  #Code lower down selecting type of margin implements this...
}

if ((length(type)>1) & (subtotals==FALSE)) { 
  warning("WARNING: Can only request supply one table type if requesting suppression of subtotals; suppression of subtotals not executed")
  subtotals <- TRUE
}

if ((length(type)==1) & (subtotals==FALSE)) {
  choices <- c("frequency", "row.pct", "column.pct", "joint.pct", "total.pct")
  tp <- match.arg(type, choices)
  if (tp %in% c("row.pct","column.pct","joint.pct")) {
    warning("WARNING: subtotals can only be suppressed for tables of type 'frequency' or 'total.pct'")
    subtotals<- TRUE
  }
}

if ((n.vars > 2) & (n.col.vars>1) & (subtotals==FALSE)) 
  warning("WARNING: suppression of subtotals assumes only 1 col var; table flattened accordingly")


if ( (subtotals==FALSE) & (n.vars>2) )  {
  #If subtotals not required AND total table vars > 2
  #Reassign all but last col.var as row vars
  #[because, for simplicity, crosstabs assumes removal of subtotals uses tables with only ONE col var]
  #N.B. Subtotals only present in tables with > 2 cross-classified vars...
  if (length(col.vars)>1) {
    row.vars <- c(row.vars,col.vars[-length(col.vars)])
    col.vars <- col.vars[length(col.vars)]
    n.row.vars <- length(row.vars)
    n.col.vars <- 1
  }
}

#If dec.places not set by user, set to 2 unless only one table of type frequency requested,
#in which case set to 0.  [Leaves user with possibility of having frequency tables with > 0 dp]
if (is.null(dec.places)) {
  if ((length(type)==1) & (type[1]=="frequency")) {
    dec.places <- 0
  } else {
    dec.places <-2
  }
}

#Take the original input data, whatever form originally supplied in,
#convert into table format using requested row and col vars, and save as 'tbl'

args <- list(...)    

if (length(args) > 1) {
  if (!all(sapply(args, is.factor))) 
    stop("If more than one argument is passed then all must be factors")
  tbl <- table(...)
}
else {
  if (is.factor(...)) {
    tbl <- table(...)
  }
  else if (is.table(...)) {
    tbl <- eval(...)
  }
  else if (is.data.frame(...)) {
    #tbl <- table(...)
    if (is.null(row.vars) && is.null(col.vars)) {
      tbl <- table(...)
    }
    else {
      var.names <- c(row.vars,col.vars)
      A <- (...)
      tbl <- table(A[var.names])
      if(length(var.names==1)) names(dimnames(tbl)) <- var.names
      #[table() only autocompletes dimnames for multivariate crosstabs of dataframes]
    }
  }
  else if (class(...) == "ftable") {
    tbl <- eval(...)
    if (is.null(row.vars) && is.null(col.vars)) {
      row.vars <- names(attr(tbl, "row.vars"))
      col.vars <- names(attr(tbl, "col.vars"))
    }
    tbl <- as.table(tbl)
  }
  else if (class(...) == "ctab") {
    tbl <- eval(...)
    if (is.null(row.vars) && is.null(col.vars)) {
      row.vars <- tbl$row.vars
      col.vars <- tbl$col.vars
    }
    for (opt in c("dec.places", "type", "style", "percentages", 
                  "addmargins", "subtotals")) if (is.null(get(opt))) 
                    assign(opt, eval(parse(text = paste("tbl$", opt, 
                                                        sep = ""))))
    tbl <- tbl$table
  }
  else {
    stop("first argument must be either factors or a table object")
  }
}

#Convert supplied table style into full text string (e.g. "l" becomes "long")
style <- match.arg(style, c("long", "wide"))

#Extract row and col names to be used in creating 'tbl' from supplied input data
nms <- names(dimnames(tbl))
z <- length(nms)
if (!is.null(row.vars) && !is.numeric(row.vars)) {
  row.vars <- order(match(nms, row.vars), na.last = NA)
}
if (!is.null(col.vars) && !is.numeric(col.vars)) {
  col.vars <- order(match(nms, col.vars), na.last = NA)
}
if (!is.null(row.vars) && is.null(col.vars)) {
  col.vars <- (1:z)[-row.vars]
}
if (!is.null(col.vars) && is.null(row.vars)) {
  row.vars <- (1:z)[-col.vars]
}
if (is.null(row.vars) && is.null(col.vars)) {
  col.vars <- z
  row.vars <- (1:z)[-col.vars]
}

#Take the original input data, converted into table format using supplied row and col vars (tbl)
#and create a second version (crosstab) which stores results as percentages if a percentage table type is requested.
if (type[1] == "frequency") 
  crosstab <- tbl
else 
  crosstab <- mk.pcnt.tbl(tbl, type[1])


#If multiple table types requested, create and add these to 
if (length(type) > 1) {
  tbldat <- as.data.frame.table(crosstab)
  z <- length(names(tbldat)) + 1
  tbldat[z] <- 1
  pcntlab <- type
  pcntlab[match("frequency", type)] <- "Count"
  pcntlab[match("row.pct", type)] <- "Row %"
  pcntlab[match("column.pct", type)] <- "Column %"
  pcntlab[match("joint.pct", type)] <- "Joint %"
  pcntlab[match("total.pct", type)] <- "Total %"
  for (i in 2:length(type)) {
    if (type[i] == "frequency") 
      crosstab <- tbl
    else crosstab <- mk.pcnt.tbl(tbl, type[i])
    crosstab <- as.data.frame.table(crosstab)
    crosstab[z] <- i
    tbldat <- rbind(tbldat, crosstab)
  }
  tbldat[[z]] <- as.factor(tbldat[[z]])
  levels(tbldat[[z]]) <- pcntlab
  crosstab <- xtabs(Freq ~ ., data = tbldat)
  names(dimnames(crosstab))[z - 1] <- ""
}


#Add margins if required, adding only those margins appropriate to user request
if (addmargins==TRUE) {
  
  vars <- c(row.vars,col.vars)
  
  if (length(type)==1) {
    if (type=="row.pct") 
    { crosstab <- addmargins(crosstab,margin=c(vars[n.vars]))
    tbl <- addmargins(tbl,margin=c(vars[n.vars]))
    }
    else 
    { if (type=="column.pct") 
    { crosstab <- addmargins(crosstab,margin=c(vars[n.row.vars]))
    tbl <- addmargins(tbl,margin=c(vars[n.row.vars]))
    }
      else 
      { if (type=="joint.pct") 
      { crosstab <- addmargins(crosstab,margin=c(vars[(n.row.vars)],vars[n.vars])) 
      tbl <- addmargins(tbl,margin=c(vars[(n.row.vars)],vars[n.vars])) 
      }
        else #must be total.pct OR frequency
        { crosstab <- addmargins(crosstab)
        tbl <- addmargins(tbl)
        }
      }
    } 
  }
  
  #If more than one table type requested, only adding row totals makes any sense...
  if (length(type)>1) {
    crosstab <- addmargins(crosstab,margin=c(vars[n.vars]))
    tbl <- addmargins(tbl,margin=c(vars[n.vars]))
  }
  
}  


#If subtotals not required, and total vars > 2, create dataframe version of table, with relevant
#subtotal rows / cols dropped [Subtotals only present in tables with > 2 cross-classified vars]
t1 <- NULL
if ( (subtotals==FALSE) & (n.vars>2) )  {
  
  #Create version of crosstab in ftable format
  t1 <- crosstab 
  t1 <- ftable(t1,row.vars=row.vars,col.vars=col.vars)
  
  #Convert to a dataframe
  t1 <- as.data.frame(format(t1),stringsAsFactors=FALSE)
  
  #Remove backslashes from category names AND colnames
  t1 <- apply(t1[,],2, function(x) gsub("\"","",x))
  #Remove preceding and trailing spaces from category names to enable accurate capture of 'sum' rows/cols
  #[Use of grep might extract category labels with 'sum' as part of a longer one or two word string...]
  t1 <- apply(t1,2,function(x) gsub("[[:space:]]*$","",gsub("^[[:space:]]*","",x)))
  
  #Reshape dataframe to that variable and category labels display as required
  #(a) Move col category names down one row; and move col variable name one column to right
  t1[2,(n.row.vars+1):ncol(t1)] <- t1[1,(n.row.vars+1):ncol(t1)]
  t1[1,] <- ""
  t1[1,(n.row.vars+2)] <- t1[2,(n.row.vars+1)]    
  #(b) Drop the now redundant column separating the row.var labels from the table data + col.var labels
  t1 <- t1[,-(n.row.vars+1)]
  
  #In 'lab', assign category labels for each variable to all rows (to allow identification of sub-totals) 
  lab <- t1[,1:n.row.vars]
  for (c in 1:n.row.vars) {
    for (r in 2:nrow(lab)) {
      if (lab[r,c]=="") lab[r,c] <- lab[r-1,c]  
    }
  }
  
  lab <- (apply(lab[,1:n.row.vars],2,function(x) x=="Sum"))
  lab <- apply(lab,1,sum)
  #Filter out rows of dataframe containing subtotals
  
  t1 <- t1[((lab==0) | (lab==n.row.vars)),]
  
  #Move the 'Sum' label associated with last row to the first column; in the process
  #setting the final row labels associated with other row variables to ""
  t1[nrow(t1),1] <- "Sum"
  t1[nrow(t1),(2:n.row.vars)] <- ""
  
  #set row and column names to NULL
  rownames(t1) <- NULL
  colnames(t1) <- NULL
  
}



#Create output object 'result' [class: crosstab]
result <- NULL
#(a) record of argument values used to produce tabular output
result$row.vars <- row.vars
result$col.vars <- col.vars
result$dec.places <- dec.places
result$type <- type
result$style <- style
result$percentages <- percentages
result$addmargins <- addmargins
result$subtotals <- subtotals

#(b) tabular output [3 variants]
result$table <- tbl  #Stores original cross-tab frequency counts without margins [class: table]
result$crosstab <- crosstab #Stores cross-tab in table format using requested style(frequency/pct) and table margins (on/off)
#[class: table]  
result$crosstab.nosub <- t1  #crosstab with subtotals suppressed [class: dataframe; or NULL if no subtotals suppressed]  
class(result) <- "crosstab"    

#Return 'result' as output of function
result
}
```

Introduction
===================

Transportation planning for decades has focused on providing mobility for the private automobile. This is a model of development that was initially introduced in North America as a solution to problems created by rapid urbanization, and that was eventually copied elsewhere [@Brown2009planning;@Angotti1996latin]. Despite the initial promise of automotive technology, it is now evident that mobility centered on the private automobile has given rise to a litany of maladies that are in urgent need of correction. This includes environmental concerns [i.e., climate change; @Chapman2007transport] as well as numerous other social [@Boschman2008toward; @Lucas2012transport; @Lucas2019evolution], health [@Khreis2016health; @Milne2012public], and equity issues [@Bocarejo2012transport; @Martens2012justice; @Pereira2017distributive].

As the impacts of our societal dependence on the private automobile have become increasingly evident, the transportation agenda has aimed to shift focus to the reduction of car use and towards the creation of mobility polycultures that offer a broader menu of transportation alternatives other than primarily (or even just) the private automobile [@Miller2011collaborative; @Lavery2013driving]. In order to successfully achieve this goal, it is essential not only to provide the services and facilities that support public transportation and active travel, but also to attract new users to these modes of transportation [@Ettema2011satisfaction]. Within this context, it has been argued that sustainable transportation policies require all participants in the transportation system to challenge what Gossling and Cohen [-@Gossling2014sustainable] termed _transportation taboos_: deep-seated ideas concerning the contribution to emissions by individuals, the inequality of market-based approaches, and the social and psychological functions of transportation. With respect to the latter, subjective wellbeing (SWB) is increasingly recognized as a policy goal in and of itself [@Diener2015national; @Dolan2012measuring], and also as an intermediate objective to achieve ulterior goals. Accordingly, there is a growing consensus in the field of transportation about the need to move beyond a purely utilitarian focus to understand the affective and wellbeing values of the transportation experience [e.g., @Anable2005work; @Devos2013travel; @Domarchi2008effect; @Gatersleben2007affective; @Steg2005car]. Consideration of factors related to subjective wellbeing, for example, are useful for policy-makers to enhance the experience of travel, to increase satisfaction with travel, and to meet the preferences of travelers [@Chatterjee2019commuting].

A definition of subjective wellbeing is as “[g]ood mental states, including all of the various evaluations, positive and negative, that people make of their lives, and the affective reactions of people to their experiences” [@oecd2013oecd, p. 10]. As memorably put by Steg [-@Steg2005car]: is the use of a car a must, or is it a lust? A close alignment, or consonance, between affective reactions and the mode of transportation used to travel can result in greater subjective wellbeing and increase the probability of choosing that mode (i.e., by satisfying the _lust_); on the other hand, dissonance, namely the lack of concordance between the mode used and the affective reaction to that mode, would be detrimental to subjective wellbeing, especially to those for whom the use of the mode is a _must_ [@Devos2019satisfaction; @Mokhtarian2018travel]. With these considerations in mind, the present research aims to investigate _who_ experiences affective dissonance with respect to their primary mode of travel. We focus our investigation on reactions from the perspective of feelings of Freedom, Enjoyment, Happiness, Poverty, Luxury, and Status - concepts termed _affective values_ hereafter. Furthermore, it is possible, even if use of a particular mode is a _must_, that travelers may still _lust_ for something else - in other words, the grass may look greener from the window of a car. For this reason, we also aim to investigate which mode or modes are most commonly identified as ideal from the perspective of the aforementioned affective values.

Our research is based on data collected from a sample of travelers in the city of Santiago in Chile. The analysis sheds light on the affective reactions of people towards their primary mode of travel, and their perceptions towards 'ideal modes'. This reveals important differences in situations when the ideal mode of a traveler is not the mode they actually use - or in other words, the affective dissonance between actual and ideal modes of travel. More concretely, the results indicate that users of public transportation experience the most dissonance, followed by automobile users, and finally active travelers, who tend to experience the least affective dissonance. For those travelers who experience dissonance, active travel is the mode most commonly associated with Freedom, Enjoyment, and Happiness, whereas public transportation is most commonly associated with Poverty, and the automobile is most commonly associated with Luxury and Status. We also find that there are significant variations in dissonance by age, education, income, and typical commute time. The reactions of travelers towards various transport modes are critical factors that policy-makers need to consider to promote and increase the use of public transport and active modes [@Bornioli2019affective; @Devos2017travel; @Devos2019satisfying; @Garling2019role; @Redman2013quality].

After these introductory remarks, the paper follows up with a review of the literature on the topics of subjective wellbeing and affective values. Next, we discuss the case study, as well as the methodology and data used for this research. The analysis and results of the study are presented afterwards, before concluding with some discussion and directions for future research and policy.

Please note that this document  was prepared using R Markdown and is an example of reproducible research [@Brunsdon2020opening]. The R Markdown file, along with the data file needed to reproduce the analysis, are available for download [here](https://github.com/paezha/Mode-Dissonance-and-Subjective-Wellbeing).

Background
===================

A consensus has emerged in recent years regarding the need to complement the traditional utilitarian perspective of transportation by investigating mobility and transport from the lens of their affective functions. The affective value of transportation is important due to its potential to improve or detract from SWB. 

One of the primary ways to explore issues of subjective wellbeing in transportation has been the satisfaction that travelers feel towards their everyday mobility experience [e.g., @Bergstad2011subjective]. As a consequence, there is a wealth of research on satisfaction with the use of different modes of transportation. For example, numerous studies report that car users often have a higher level of satisfaction compared to other transport modes [@Bergstad2011affective; @Eriksson2013perceived; @Redmond2001positive], although others report highest commute satisfaction for bicycle and train commuters [e.g., @Whalen2013mode; @Handy2019commute]. In a similar way, there are multiple reports that active travel also tends to yield higher levels of satisfaction [@Gatersleben2007affective; @Smith2017commute; @Stlouis2014happy; @Paez2010enjoyment; @Whalen2013mode; @Handy2019commute], In contrast, public transport users often assess their experience more negatively [@Abenoza2017travel; @Devos2016travel; @Gatersleben2007affective; @Handy2019commute; @Paez2010enjoyment]. Multi-modal trips also influence satisfaction levels; for instance, individuals tend to report higher levels of satisfaction with the mode they use – perhaps as a form of _post hoc_ validation of their choices or circumstance [@Susilo2014exploring].

While travel satisfaction has often been used in the context of daily trips – typically linked to cost-benefit and utilitarian measurements –, the evaluation of subjective wellbeing (SWB) over time has risen as an alternative measure. Ettema et al. [-@Ettema2010out, p. 725] define SWB as the degree to which an individual positively evaluates the overall quality of their lives, where the general life satisfaction encompasses a more extended temporal period – which implies greater temporal stability. This concept has prompted a growing literature that complements and applies SWB in a broader range of satisfaction scales and situations. The definition of other factors such as travel choice mode, attitudes, and external elements of the built environment have been studied for a broader understanding of the changes produced in the SWB [e.g., @Handy2019commute]. As these factors do not necessarily apply to longer-term general life satisfaction, other studies have aimed to determine both the direct and indirect effects on the perception of users [see, e.g., @Ye2017satisfaction]. Other concepts have also emerged, including the Satisfaction with Travel Scale [@Ettema2011satisfaction], as well as different scales based on people’s perceptions of travel. De Vos et al. [-@Devos2015satisfying], for instance, explore in detail the underlying dimensions of the affective domain of STS on which SWB is based [for more on STS also see @Friman2013psychometric].

The literature on SWB has demonstrated a relationship between people’s perceptions and satisfaction with their daily travel [e.g., @Smith2017commute; @Stlouis2014happy; @Mokhtarian2018travel]. Scholars have shown that accessibility is among the most studied factors that influences subjective wellbeing [@Delbosc2012role], and activities have a direct impact on travel satisfaction [@Bergstad2011subjective]. Delbosc [-@Delbosc2012role, p. 28], for instance, has summarized the most significant influences on psychological wellbeing: poverty and employment, meaningful relationships and health. However, understanding the components that affect these perceptions implies the differentiation between affective (also named as symbolic-affective) and instrumental values [@Bergstad2011affective]. Steg et al. (2011) have compared symbolic-affective and instrumental-reasoned motives for car-use, and similar findings are reported in other studies [e.g., @Gatersleben2007affective; @Lois2009relationship]. Previous research also demonstrates how socio-demographic factors affect the levels of SWB, including income [@Clark1996satisfaction; @Ferrer2005income], education and unemployment [@Argyle1999causes], age [@Diener1997subjective], and gender [@Tesch2008gender]. However, further research beyond the determinants of trip satisfaction is needed to understand how these socio-demographic variables connect with the affective reactions to various modes of travel [@Stlouis2014happy]. 

The research needs outlined above are well-recognized in the developed world, but there is still a dearth of research in the context of the Global South. Historical inequality in many developing countries has led to strong symbolic attachments to the automobile, in addition to negative connotations for public transport and active travel [@Zorrilla2019exploring]. To address this gap in knowledge a body of literature has emerged to investigate the affective aspects of travel behavior in a number of developing countries. A cross-country study in Asia revealed that the affective factors of public transportation and car use are important, and in particular the social orderliness of transit was suggested as a way to make this mode more attractive to users [@Van2014effect]. In terms of active travel, a study in China found that attitudes that embrace new styles and technologies despite their cost are associated with the intention to continue using shared bicycles [@Shao2019analysis]. The importance of affective factors for policy and planning is further highlighted by research in Colombia that shows the pride users feel when using a bicycle shared system. This affective reaction is above and beyond other positive feelings, such as a sense of belongingness to a civic culture, and the enjoyment and pleasure of active travel itself [@Bejarano2017user].  

Case Study and Data
===================

## Context

The case study for the present research is Santiago. Santiago is the capital of Chile, a country with one of the highest levels of socio-economic inequality in the world. A tangible manifestation of the inequalities experienced by many in Chile is the large disparity in the relative cost of transportation, travel time, and distance traveled by different socio-economic segments of the population. To further complicate matters, strong spatial segregation also conditions car ownership and the use of public transportation – the higher the income, the higher the use of the automobile; conversely, the lower the income, the higher the reliance on public transportation. Although the transportation experience is but one of many dimensions of inequality, the experiences in this sector have triggered exceptional discomfort and dissatisfaction among the public. Recent social unrest, triggered by a seemingly minor hike in the fare of public transportation, brought many of these concerns to the forefront of the public conscience in dramatic fashion [e.g., @Davis2019]. 

Previous research has helped to contextualize everyday mobility in Santiago relative to other Latin American cities [e.g., @Avellaneda2011; @RodriguesVignoli2008], but much remains to be explored. Measuring instruments and new methods have led to more accurate and precise understandings of the social issues that arise as consequence of transport infrastructure and housing provision [@Cox2016], and the minimum provision of basic services [@TiznadoAitken2016]. However, the focus on accessibility as a measure of inequalities remains predominant [@TiznadoAitken2016; @Figueroa2018; @Niehaus2016; @Rojas2016].  

## Data

The study is based on a survey conducted in the city of Santiago during the months of November and December of 2016, at the end of the Spring and beginning of Summer seasons. The survey collected information on a wide range of transportation and related issues, and the data collection protocol considered a quota-sampling method for gathering the information, considering the socio-demographic information from Pre-Census of 2012. The survey was carried out face-to-face in centers of activity with dense provision of offices, services, and educational centers. An equal representation of both genders and a representation of the proportion of inhabitants per area were chosen as relevant characteristics of the sample. In total, there were $n=451$ valid responses, although not every response was complete and some questions have missing values.

The study considers data from 3 out of 8 sections of a longer survey. The relevant sections of the survey concern the individual characteristics of respondents, their feelings and affective responses related to their commute, and aspects describing their regular commute trips. In terms of individual characteristics and their commute, participants were asked socio-demographic information, including age (coded in three classes: younger than 35, older than 35 but younger than 55, and 55 and older); level of education (three classes: Kindergarten to grade 12, or K-12, technical diploma or university graduate, and graduate degree), income (three classes, by tertile), and the typical duration of the respondent's regular commute (four classes, by duration in minutes). The descriptive statistics of the sample appear in Figure \ref{fig:descriptive-statistics}. The sample trends to younger (56% is younger than 34 years old) and well-educated respondents (68% of respondents having technical or professional education), with an almost uniform distribution of income levels. The trend in typical commute time is towards longer commutes – e.g. 55% of the trips are longer than 40 minutes, and from those 56% corresponds to trips over the 60 minutes long.

```{r plot-descriptive-statistics, echo=FALSE, cache = TRUE,  fig.cap="\\label{fig:descriptive-statistics}Descriptive statistics of the sample"}

# Bar plots with descriptive statistics for the sample

age_plot <- ggplot(data = drop_na(Overall_dissonance), aes(x = AGE, fill = AGE)) +
  geom_bar() +
  theme_tufte() +
  xlab("Age of respondents") +
  scale_fill_viridis_d() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

education_plot <- ggplot(data = drop_na(Overall_dissonance), aes(x = EDUCATION, fill = EDUCATION)) +
  geom_bar() +
  theme_tufte() +
  xlab("Education level of respondents") +
  scale_fill_viridis_d() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

income_plot <- ggplot(data = drop_na(Overall_dissonance), aes(x = INCOME, fill = INCOME)) +
  geom_bar() +
  theme_tufte() +
  xlab("Income level of respondents") +
  scale_fill_viridis_d() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

time_plot <- ggplot(data = drop_na(Overall_dissonance), aes(x = TRAVEL_TIME, fill = TRAVEL_TIME)) +
  geom_bar() +
  theme_tufte() +
  xlab("Duration of regular commute") +
  scale_fill_viridis_d() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

grid.arrange(age_plot, education_plot, income_plot, time_plot)
```

In addition, respondents were asked about their primary mode of travel for their regular commute. The modes available were Car; Taxi; _Colectivo_ (a form of shared ride, intermediate in flexibility and capacity between taxi and bus); Motorcycle; Metro; Bus; Bicycle; and Walking. As seen in the top panel of Figure \ref{fig:primary-mode-travel}, the three most common modes of travel are Metro, Bus, and Car, followed by Walking and Bicycle. For the analysis, we aggregate these modes into the following categories (bottom panel of Figure \ref{fig:primary-mode-travel}): (26% of total modes – which corresponds to 91% of the total of private motorized modes), Active (9% \- Walking + Bicycle), Public (60% \- Metro + Bus), and Other motorized modes (6% \- Taxi + Colectivo + Motorcycle).  

```{r figure-primary-mode-travel, fig.width= 4, fig.height=6, echo=FALSE, cache = TRUE,  fig.cap="\\label{fig:primary-mode-travel}Frequency of primary mode used for regular commute; top panel: all modes, bottom panel: aggregated modes"}
mode_plot1 <- ggplot(data = master, aes(x = factor(USED, levels = c("A", "G", "H", "E", "F", "B", "C", "D"),
                                                   labels = c("Car", "Bicycle", "Walk", "Metro", "Bus", "Taxi", "Colectivo", "Motorcycle")),
                                        fill = USED)) +
  geom_bar() +
  xlab("Primary Mode of Travel") +
  scale_fill_manual(values = c("A" = "#F8766D", 
                               "G" = "#00BA38", "H" = "#00BA38", 
                               "E" = "#619CFF", "F" = "#619CFF", 
                               "B" = "#C77CFF", "C" = "#C77CFF", "D" = "#C77CFF")) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

mode_plot2 <- ggplot(data = Overall_dissonance, aes(x = USED, fill = USED)) +
  geom_bar() +
  xlab("Primary Mode of Travel") +
  scale_fill_manual(values = c("Car" = "#F8766D", "Active" = "#00BA38", "Public" = "#619CFF", "Other" = "#C77CFF")) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none")

grid.arrange(mode_plot1, mode_plot2, nrow = 2)
```

Of particular interest for the present study is the following question in Part 3 of the survey:

>> Q: Please indicate the mode(s) of transport that you relate to the following feelings and concepts

The question was asked for each of the following affective values: Freedom; Enjoyment; Happiness; Poverty; Luxury; and Status. The respondents were not constrained to select only one alternative, but could indicate by means of checkboxes any and all modes that they felt aligned with each affective value. This allows us to analyze the mode dissonance. Dissonance is a concept introduced into the transportation literature by Schwanen and Mokhtarian [-@Schwanen2004extent] based on earlier work by Feldman [-@Feldman1990settlement]. Originally used to investigate residential dissonance [@Schwanen2004extent], the concept has since been extended in the travel behavior literature to encompass the mismatch between the choices individuals make, and the alternatives that would enable users to improve their experience. This includes, for example, travel mode dissonance [@Devos2018people]. 

Based on the primary mode of travel and the questions about affective values, we derived a series of travel mode dissonance variables according to the following rule:
$$
D_{ij} = 
\begin{cases}
0 & if \text{ primary mode of traveler }i == \text{mode associated with value } j\\
1 & \text{ otherwise}
\end{cases}
$$
Therefore, if respondent $i$ travels primarily by Car, but indicated any other mode(s) in relation to Freedom, the respondent experienced dissonance:
$$
D_{i,\text{Freedom}} = 1
$$

In these calculations we account for all modes identified by respondents in relation to the affective values. Therefore, to avoid double counting the respondents in our frequency tabulations, we also calculated a sample weight as the inverse of the number of modes selected in response to each affective value. For instance, for respondents who selected two modes in relation to affective value $j$, each of these two modes receive a weight of $w_{ij}=1/2$; if a respondent selected three modes, then their weights are $w_{ij}=1/3$; and so on. In this way we do not treat unfairly those respondents who selected only one mode, and the sum of all weighted responses is equal to the size of the sample $n$.

Results
==========

In what follows, the results refer to two related but distinct questions. The first part of the analysis seeks to understand _who_ experiences dissonance, whereas the second part, building off that, aims to explore _which modes_ are more commonly identified as embodying affective values by those travelers who experience dissonance.

```{r cross-with-instrumental, include=FALSE, eval=FALSE}

# Create cross tabulations by each respondent characteristic (i.e., AGE, EDUCATION, INCOME, mode USED, and TRAVEL_TIME)

## Age

age_by_freedom <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "FREEDOM_DISSONANCE", type = "r")
age_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
age_by_happiness <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "HAPPINESS_DISSONANCE", type = "r")
age_by_safety <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "SAFETY_DISSONANCE", type = "r")
age_by_time <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "TIME_DISSONANCE", type = "r")
age_by_efficiency <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "EFFICIENCY_DISSONANCE", type = "r")

## Education

education_by_freedom <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "FREEDOM_DISSONANCE", type = "r")
education_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
education_by_happiness <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "HAPPINESS_DISSONANCE", type = "r")
education_by_safety <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "SAFETY_DISSONANCE", type = "r")
education_by_time <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "TIME_DISSONANCE", type = "r")
education_by_efficiency <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "EFFICIENCY_DISSONANCE", type = "r")

## Income

income_by_freedom <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "FREEDOM_DISSONANCE", type = "r")
income_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
income_by_happiness <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "HAPPINESS_DISSONANCE", type = "r")
income_by_safety <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "SAFETY_DISSONANCE", type = "r")
income_by_time <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "TIME_DISSONANCE", type = "r")
income_by_efficiency <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "EFFICIENCY_DISSONANCE", type = "r")

## Mode

mode_by_freedom <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "FREEDOM_DISSONANCE", type = "r")
mode_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
mode_by_happiness <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "HAPPINESS_DISSONANCE", type = "r")
mode_by_safety <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "SAFETY_DISSONANCE", type = "r")
mode_by_time <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "TIME_DISSONANCE", type = "r")
mode_by_efficiency <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "EFFICIENCY_DISSONANCE", type = "r")

## Travel Time

time_by_freedom <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "FREEDOM_DISSONANCE", type = "r")
time_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
time_by_happiness <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "HAPPINESS_DISSONANCE", type = "r")
time_by_safety <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "SAFETY_DISSONANCE", type = "r")
time_by_time <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "TIME_DISSONANCE", type = "r")
time_by_efficiency <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "EFFICIENCY_DISSONANCE", type = "r")

```

```{r cross-without-instrumental, include=FALSE}

# Create cross tabulations by each respondent characteristic (i.e., AGE, EDUCATION, INCOME, mode USED, and TRAVEL_TIME)

## Age

age_by_freedom <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "FREEDOM_DISSONANCE", type = "r")
age_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
age_by_happiness <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "HAPPINESS_DISSONANCE", type = "r")
age_by_poverty <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "POVERTY_DISSONANCE", type = "r")
age_by_luxury <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "LUXURY_DISSONANCE", type = "r")
age_by_status <- crosstab(Overall_dissonance, row.vars = "AGE", col.vars = "STATUS_DISSONANCE", type = "r")

## Education

education_by_freedom <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "FREEDOM_DISSONANCE", type = "r")
education_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
education_by_happiness <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "HAPPINESS_DISSONANCE", type = "r")
education_by_poverty <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "POVERTY_DISSONANCE", type = "r")
education_by_luxury <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "LUXURY_DISSONANCE", type = "r")
education_by_status <- crosstab(Overall_dissonance, row.vars = "EDUCATION", col.vars = "STATUS_DISSONANCE", type = "r")

## Income

income_by_freedom <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "FREEDOM_DISSONANCE", type = "r")
income_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
income_by_happiness <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "HAPPINESS_DISSONANCE", type = "r")
income_by_poverty <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "POVERTY_DISSONANCE", type = "r")
income_by_luxury <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "LUXURY_DISSONANCE", type = "r")
income_by_status <- crosstab(Overall_dissonance, row.vars = "INCOME", col.vars = "STATUS_DISSONANCE", type = "r")

## Mode

mode_by_freedom <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "FREEDOM_DISSONANCE", type = "r")
mode_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
mode_by_happiness <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "HAPPINESS_DISSONANCE", type = "r")
mode_by_poverty <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "POVERTY_DISSONANCE", type = "r")
mode_by_luxury <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "LUXURY_DISSONANCE", type = "r")
mode_by_status <- crosstab(Overall_dissonance, row.vars = "USED", col.vars = "STATUS_DISSONANCE", type = "r")

## Travel Time

time_by_freedom <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "FREEDOM_DISSONANCE", type = "r")
time_by_enjoyment <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "ENJOYMENT_DISSONANCE", type = "r")
time_by_happiness <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "HAPPINESS_DISSONANCE", type = "r")
time_by_poverty <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "POVERTY_DISSONANCE", type = "r")
time_by_luxury <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "LUXURY_DISSONANCE", type = "r")
time_by_status <- crosstab(Overall_dissonance, row.vars = "TRAVEL_TIME", col.vars = "STATUS_DISSONANCE", type = "r")

```

```{r collect-cross-tabulation-results-with-instrumental, include=FALSE, eval=FALSE}

# Collect the cross tabulations for each of the respondent's characteristics and the ATTRIBUTES

## Age

age_results <- cbind(age_by_freedom$crosstab, 
                     age_by_enjoyment$crosstab, 
                     age_by_happiness$crosstab,
                     age_by_safety$crosstab,
                     age_by_time$crosstab,
                     age_by_efficiency$crosstab)

# Drop the row totals
age_results <- age_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(age_results) <- c("Freedom", "Enjoyment", "Happiness", "Safety", "Time", "Efficiency")

# Convert to dataframe and make the rownames a variable
age_results <- age_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
age_results <- age_results %>%
  mutate(chi2.freedom = summary(age_by_freedom$table)$p.value,
         chi2.enjoyment = summary(age_by_enjoyment$table)$p.value,
         chi2.happiness = summary(age_by_happiness$table)$p.value,
         chi2.safety = summary(age_by_safety$table)$p.value,
         chi2.time = summary(age_by_time$table)$p.value,
         chi2.efficiency = summary(age_by_efficiency$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Safety,
                chi2.safety,
                Time,
                chi2.time,
                Efficiency,
                chi2.efficiency)

## Education

education_results <- cbind(education_by_freedom$crosstab, 
                           education_by_enjoyment$crosstab, 
                           education_by_happiness$crosstab,
                           education_by_safety$crosstab,
                           education_by_time$crosstab,
                           education_by_efficiency$crosstab)

# Drop the row totals
education_results <- education_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(education_results) <- c("Freedom", "Enjoyment", "Happiness", "Safety", "Time", "Efficiency")

# Convert to dataframe and make the rownames a variable
education_results <- education_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
education_results <- education_results %>%
  mutate(chi2.freedom = summary(education_by_freedom$table)$p.value,
         chi2.enjoyment = summary(education_by_enjoyment$table)$p.value,
         chi2.happiness = summary(education_by_happiness$table)$p.value,
         chi2.safety = summary(education_by_safety$table)$p.value,
         chi2.time = summary(education_by_time$table)$p.value,
         chi2.efficiency = summary(education_by_efficiency$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Safety,
                chi2.safety,
                Time,
                chi2.time,
                Efficiency,
                chi2.efficiency)

## Income

income_results <- cbind(income_by_freedom$crosstab, 
                        income_by_enjoyment$crosstab, 
                        income_by_happiness$crosstab,
                        income_by_safety$crosstab,
                        income_by_time$crosstab,
                        income_by_efficiency$crosstab)

# Drop the row totals
income_results <- income_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(income_results) <- c("Freedom", "Enjoyment", "Happiness", "Safety", "Time", "Efficiency")

# Convert to dataframe and make the rownames a variable
income_results <- income_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
income_results <- income_results %>%
  mutate(chi2.freedom = summary(income_by_freedom$table)$p.value,
         chi2.enjoyment = summary(income_by_enjoyment$table)$p.value,
         chi2.happiness = summary(income_by_happiness$table)$p.value,
         chi2.safety = summary(income_by_safety$table)$p.value,
         chi2.time = summary(income_by_time$table)$p.value,
         chi2.efficiency = summary(income_by_efficiency$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Safety,
                chi2.safety,
                Time,
                chi2.time,
                Efficiency,
                chi2.efficiency)

## Mode USED

mode_results <- cbind(mode_by_freedom$crosstab, 
                      mode_by_enjoyment$crosstab, 
                      mode_by_happiness$crosstab,
                      mode_by_safety$crosstab,
                      mode_by_time$crosstab,
                      mode_by_efficiency$crosstab)

# Drop the row totals
mode_results <- mode_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(mode_results) <- c("Freedom", "Enjoyment", "Happiness", "Safety", "Time", "Efficiency")

# Convert to dataframe and make the rownames a variable
mode_results <- mode_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
mode_results <- mode_results %>%
  mutate(chi2.freedom = summary(mode_by_freedom$table)$p.value,
         chi2.enjoyment = summary(mode_by_enjoyment$table)$p.value,
         chi2.happiness = summary(mode_by_happiness$table)$p.value,
         chi2.safety = summary(mode_by_safety$table)$p.value,
         chi2.time = summary(mode_by_time$table)$p.value,
         chi2.efficiency = summary(mode_by_efficiency$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Safety,
                chi2.safety,
                Time,
                chi2.time,
                Efficiency,
                chi2.efficiency)

## Time

time_results <- cbind(time_by_freedom$crosstab, 
                      time_by_enjoyment$crosstab, 
                      time_by_happiness$crosstab,
                      time_by_safety$crosstab,
                      time_by_time$crosstab,
                      time_by_efficiency$crosstab)

# Drop the row totals
time_results <- time_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(time_results) <- c("Freedom", "Enjoyment", "Happiness", "Safety", "Time", "Efficiency")

# Convert to dataframe and make the rownames a variable
time_results <- time_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
time_results <- time_results %>%
  mutate(chi2.freedom = summary(time_by_freedom$table)$p.value,
         chi2.enjoyment = summary(time_by_enjoyment$table)$p.value,
         chi2.happiness = summary(time_by_happiness$table)$p.value,
         chi2.safety = summary(time_by_safety$table)$p.value,
         chi2.time = summary(time_by_time$table)$p.value,
         chi2.efficiency = summary(time_by_efficiency$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Safety,
                chi2.safety,
                Time,
                chi2.time,
                Efficiency,
                chi2.efficiency)
```

```{r collect-cross-tabulation-results-without-instrumental, include=FALSE}

# Collect the cross tabulations for each of the respondent's characteristics and the ATTRIBUTES

## Age

age_results <- cbind(age_by_freedom$crosstab, 
                     age_by_enjoyment$crosstab, 
                     age_by_happiness$crosstab,
                     age_by_poverty$crosstab,
                     age_by_luxury$crosstab,
                     age_by_status$crosstab)

# Drop the row totals
age_results <- age_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(age_results) <- c("Freedom", "Enjoyment", "Happiness", "Poverty", "Luxury", "Status")

# Convert to dataframe and make the rownames a variable
age_results <- age_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
age_results <- age_results %>%
  mutate(chi2.freedom = summary(age_by_freedom$table)$p.value,
         chi2.enjoyment = summary(age_by_enjoyment$table)$p.value,
         chi2.happiness = summary(age_by_happiness$table)$p.value,
         chi2.poverty = summary(age_by_poverty$table)$p.value,
         chi2.luxury = summary(age_by_luxury$table)$p.value,
         chi2.status = summary(age_by_status$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Poverty,
                chi2.poverty,
                Luxury,
                chi2.luxury,
                Status,
                chi2.status)

## Education

education_results <- cbind(education_by_freedom$crosstab, 
                           education_by_enjoyment$crosstab, 
                           education_by_happiness$crosstab,
                           education_by_poverty$crosstab,
                           education_by_luxury$crosstab,
                           education_by_status$crosstab)

# Drop the row totals
education_results <- education_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(education_results) <- c("Freedom", "Enjoyment", "Happiness", "Poverty", "Luxury", "Status")

# Convert to dataframe and make the rownames a variable
education_results <- education_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
education_results <- education_results %>%
  mutate(chi2.freedom = summary(education_by_freedom$table)$p.value,
         chi2.enjoyment = summary(education_by_enjoyment$table)$p.value,
         chi2.happiness = summary(education_by_happiness$table)$p.value,
         chi2.poverty = summary(education_by_poverty$table)$p.value,
         chi2.luxury = summary(education_by_luxury$table)$p.value,
         chi2.status = summary(education_by_status$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Poverty,
                chi2.poverty,
                Luxury,
                chi2.luxury,
                Status,
                chi2.status)

## Income

income_results <- cbind(income_by_freedom$crosstab, 
                        income_by_enjoyment$crosstab, 
                        income_by_happiness$crosstab,
                        income_by_poverty$crosstab,
                        income_by_luxury$crosstab,
                        income_by_status$crosstab)

# Drop the row totals
income_results <- income_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(income_results) <- c("Freedom", "Enjoyment", "Happiness", "Poverty", "Luxury", "Status")

# Convert to dataframe and make the rownames a variable
income_results <- income_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
income_results <- income_results %>%
  mutate(chi2.freedom = summary(income_by_freedom$table)$p.value,
         chi2.enjoyment = summary(income_by_enjoyment$table)$p.value,
         chi2.happiness = summary(income_by_happiness$table)$p.value,
         chi2.poverty = summary(income_by_poverty$table)$p.value,
         chi2.luxury = summary(income_by_luxury$table)$p.value,
         chi2.status = summary(income_by_status$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Poverty,
                chi2.poverty,
                Luxury,
                chi2.luxury,
                Status,
                chi2.status)

## Mode USED

mode_results <- cbind(mode_by_freedom$crosstab, 
                      mode_by_enjoyment$crosstab, 
                      mode_by_happiness$crosstab,
                      mode_by_poverty$crosstab,
                      mode_by_luxury$crosstab,
                      mode_by_status$crosstab)

# Drop the row totals
mode_results <- mode_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(mode_results) <- c("Freedom", "Enjoyment", "Happiness", "Poverty", "Luxury", "Status")

# Convert to dataframe and make the rownames a variable
mode_results <- mode_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
mode_results <- mode_results %>%
  mutate(chi2.freedom = summary(mode_by_freedom$table)$p.value,
         chi2.enjoyment = summary(mode_by_enjoyment$table)$p.value,
         chi2.happiness = summary(mode_by_happiness$table)$p.value,
         chi2.poverty = summary(mode_by_poverty$table)$p.value,
         chi2.luxury = summary(mode_by_luxury$table)$p.value,
         chi2.status = summary(mode_by_status$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Poverty,
                chi2.poverty,
                Luxury,
                chi2.luxury,
                Status,
                chi2.status)

## Time

time_results <- cbind(time_by_freedom$crosstab, 
                      time_by_enjoyment$crosstab, 
                      time_by_happiness$crosstab,
                      time_by_poverty$crosstab,
                      time_by_luxury$crosstab,
                      time_by_status$crosstab)

# Drop the row totals
time_results <- time_results[,c(2, 5, 8, 11, 14, 17)]

# Change column names
colnames(time_results) <- c("Freedom", "Enjoyment", "Happiness", "Poverty", "Luxury", "Status")

# Convert to dataframe and make the rownames a variable
time_results <- time_results %>%
  as.data.frame() %>%
  rownames_to_column()

# Add significance of chi2 tests
time_results <- time_results %>%
  mutate(chi2.freedom = summary(time_by_freedom$table)$p.value,
         chi2.enjoyment = summary(time_by_enjoyment$table)$p.value,
         chi2.happiness = summary(time_by_happiness$table)$p.value,
         chi2.poverty = summary(time_by_poverty$table)$p.value,
         chi2.luxury = summary(time_by_luxury$table)$p.value,
         chi2.status = summary(time_by_status$table)$p.value) %>%
  dplyr::select(rowname, 
                Freedom, 
                chi2.freedom,
                Enjoyment,
                chi2.enjoyment,
                Happiness,
                chi2.happiness,
                Poverty,
                chi2.poverty,
                Luxury,
                chi2.luxury,
                Status,
                chi2.status)
```

```{r crosstab-all-results-with-instrumental, include=FALSE, eval=FALSE}

# Here we bind all the results into a single dataframe for printing

xtab_results <- rbind(age_results,
                      education_results,
                      income_results,
                      mode_results,
                      time_results) %>%
  mutate(chi2.freedom = ifelse(chi2.freedom >= 0.001, paste0(round(chi2.freedom, 4)), "$<0.001$"),
         chi2.enjoyment = ifelse(chi2.enjoyment >= 0.001, paste0(round(chi2.enjoyment, 4)), "$<0.001$"),
         chi2.happiness = ifelse(chi2.happiness >= 0.001, paste0(round(chi2.happiness, 4)), "$<0.001$"),
         chi2.safety = ifelse(chi2.safety >= 0.001, paste0(round(chi2.safety, 4)), "$<0.001$"),
         chi2.time = ifelse(chi2.time >= 0.001, paste0(round(chi2.time, 4)), "$<0.001$"),
         chi2.efficiency = ifelse(chi2.efficiency >= 0.001, paste0(round(chi2.efficiency, 4)), "$<0.001$"))

xtab_results[10:13, 3] <- "$< 0.001$" # Edit the format of these cells to avoid six cells collapsing together in table
```

```{r crosstab-all-results-without-instrumental, echo=FALSE}

# Here we bind all the results into a single dataframe for printing

xtab_results <- rbind(age_results,
                      education_results,
                      income_results,
                      mode_results,
                      time_results) %>%
  mutate(chi2.freedom = ifelse(chi2.freedom >= 0.001, paste0(round(chi2.freedom, 4)), "$<0.001$"),
         chi2.enjoyment = ifelse(chi2.enjoyment >= 0.001, paste0(round(chi2.enjoyment, 4)), "$<0.001$"),
         chi2.happiness = ifelse(chi2.happiness >= 0.001, paste0(round(chi2.happiness, 4)), "$<0.001$"),
         chi2.poverty = ifelse(chi2.poverty >= 0.001, paste0(round(chi2.poverty, 4)), "$<0.001$"),
         chi2.luxury = ifelse(chi2.luxury >= 0.001, paste0(round(chi2.luxury, 4)), "$<0.001$"),
         chi2.status = ifelse(chi2.status >= 0.001, paste0(round(chi2.status, 4)), "$<0.001$"))

xtab_results[10:13, 3] <- "$< 0.001$" # Edit the format of these cells to avoid six cells collapsing together in table
```

## Who experiences dissonance?

We begin by profiling the travelers who experience dissonance. The null hypothesis is that there are no systematic differences in terms of who tends to experience affective dissonance with respect to their primary mode of travel. To investigate this hypothesis we create contingency tables to tabulate the frequency of dissonance with respect to each affective value, stratified by the individual attributes of respondents. Table \ref{tab:cross-tabulation-results} presents the frequency (in percentage) of dissonance. This is the percentage of respondents out of the total in their stratum who selected, for each affective value, a mode or mode(s) of transportation that do not correspond to their primary mode of travel.

As seen in the table, there are five individual attributes that we analyze. Three of these are socio-economic and demographic, namely age, level of education, and income. The other two are transportation related, namely primary mode of travel and commute time. The frequency tables are tested in every case using $\chi^2$ tests of independence ($p$-values are reported in the table; lower $p$-values mean that the null hypothesis of independence can be rejected with greater confidence). It is interesting to note that the only category for which all affective values are significant ($p\leq0.05$) is mode of travel.

### Age

With respect to age, previous studies have reported that older adults tend to be more satisfied with their travel experience than younger people [@Cao2014satisfaction; @Devos2016travel; @Ye2017satisfaction]. In the case, we find that there there are significant differences in dissonance by age with respect to five affective values, namely Freedom, Enjoyment, Happiness, Luxury, and Status. We observe that levels of dissonance tend to be high in general, and in no case less than 60%. For instance, almost 90% of travelers younger than 35 experience travel mode dissonance with respect to Freedom, and more than 94% experience dissonance with respect to Enjoyment. In general, younger travelers tend to experience dissonance more frequently, with dissonance being less frequent for older travelers. The exception to this trend is Luxury, an affective value for which older travelers (age >54) experience dissonance more frequently than mid-aged travelers (ages 35-54).

### Education

The results do not allow us to reject the hypothesis of equal levels of dissonance by levels of education for the values of Freedom, Enjoyment, Happiness, and Poverty. In contrast we can reject the null hypothesis in the case of two affective values, namely Luxury and Status. In the case of Luxury, dissonance is more frequent among people who have only K-12 education, and less frequently, albeit still high, for people with technical/university level education and post-graduate education. Furthermore, highly educated people (with postgraduate degrees) experience dissonance with respect to Status more frequently than with respect to Luxury.

### Income

The next individual attribute that we examine is income, and in this case we detect significant differences in dissonance for three affective values: Poverty, Luxury, and Status. Poverty is a negative affect, and can be associated with the lack of a car [@Reutter2009who]. In our case, we see that lower income individuals tend to associate this feeling to their primary mode of commuting with higher frequency (almost 20% of the time) than other income groups. Whereas approximately 16% of mid-income people are dissatisfied with their primary mode of travel when it comes to evoking feelings of Poverty, less than 7% of high income individuals are. Dissonance with respect to Luxury and Status also tends to be more common among lower income individuals, and declines substantially for mid- and high income respondents. Notice as well that the frequency of dissonance is higher in terms of Luxury than Status for mid- and high income people.

### Primary mode of travel

The variable that shows the largest differences in the frequency of dissonance is the primary mode of travel. It can be seen in Table \ref{tab:cross-tabulation-results} that the differences are significant for all six affective values. Compared to users of other modes of transportation, dissonance is particularly acute for users of public transportation when it comes to the values of Freedom, Enjoyment, and Happiness: almost 100% of users of public transportation have identified other mode or modes as better representing those affective values. Dissonance on these values is the least for active travelers: less than 50% of respondents who are active travelers associate Freedom to a different mode, and only around 60% identified a different mode when responding to the values of Enjoyment and Happiness, compared to approximately 79% and 71% of those whose primary mode is car. The picture changes when the values of Poverty, Luxury, and Status are considered. In this case, dissonance is less frequent for people who travel by car: less than 3% of car users associate the car with feelings of Poverty, only 41% associate Luxury with a mode other than car, and only about 31% relate Status to a different mode. Dissonance is more frequent in these values for active travelers, and users of public transportation and other modes, in no case being lower than 75%. This figure is virtually as high as 100% for users of public transportation, a group of travelers who consistently associate Luxury and Status with modes _other_ than public transportation.

### Typical commute time

Turning now to typical commute time, four affective values show significant differences with $p\leq0.10$: Freedom, Happiness, Luxury, and Status. Perhaps not surprisingly, dissonance is more frequent among people whose typical commutes are longer. This is in line with previous findings: both St-Louis et al. [-@Stlouis2014happy] and Smith [-@Smith2017commute] report that commute satisfaction tends to decline with longer commutes, and Handy and Thigpen [-@Handy2019commute] found that commute distance was a negative covariate of commute satisfaction. 

```{r table-cross-tabulation-results-with-instrumental, echo = FALSE, eval=FALSE}
kable(xtab_results,
      "html",
      digits = 2,
      booktabs = TRUE,
      caption = "\\label{tab:cross-tabulation-results-with-instrumental}Percentage of respondents who report mode dissonance with respect to various SWB and instrumental factors",
      escape = FALSE,
      align = c("l", rep("c", 12)),
      col.names = c("Variable", 
                    "Freedom", "$\\chi^2$ p-val", 
                    "Enjoyment", "$\\chi^2$ p-val",
                    "Happiness", "$\\chi^2$ p-val",
                    "Safety", "$\\chi^2$ p-val",
                    "Time", "$\\chi^2$ p-val",
                    "Efficiency", "$\\chi^2$ p-val")) %>%
  collapse_rows(columns = c(3, 5, 7, 9, 11, 13), latex_hline = "major", valign = "middle") %>%
  pack_rows("Age", 1, 3) %>%
  pack_rows("Education", 4, 6) %>%
  pack_rows("Income", 7, 9) %>%
  pack_rows("Mode", 10, 13) %>%
  pack_rows("Commute Time", 14, 17)  %>%
  kable_styling(bootstrap_options = c("striped", "scaled_down")) %>%
  landscape()
```

```{r table-cross-tabulation-results-without-instrumental, echo = FALSE}
kable(xtab_results,
      "html",
      digits = 2,
      booktabs = TRUE,
      caption = "\\label{tab:cross-tabulation-results}Percentage of respondents who report mode dissonance with respect to various affective values",
      escape = FALSE,
      align = c("l", rep("c", 12)),
      col.names = c("Variable", 
                    "Freedom", "$\\chi^2$ p-val", 
                    "Enjoyment", "$\\chi^2$ p-val",
                    "Happiness", "$\\chi^2$ p-val",
                    "Poverty", "$\\chi^2$ p-val",
                    "Luxury", "$\\chi^2$ p-val",
                    "Status", "$\\chi^2$ p-val")) %>%
  collapse_rows(columns = c(3, 5, 7, 9, 11, 13), latex_hline = "major", valign = "middle") %>%
  pack_rows("Age", 1, 3) %>%
  pack_rows("Education", 4, 6) %>%
  pack_rows("Income", 7, 9) %>%
  pack_rows("Mode", 10, 13) %>%
  pack_rows("Commute Time", 14, 17)  %>%
  kable_styling(bootstrap_options = c("striped", "scaled_down")) %>%
  landscape()
```

## Which modes do travelers associate with affective values?

The preceding analysis indicates that there is significant mode dissonance along various dimensions and for various affective values. This is for the most part in line with previous research, although by examining different affective values individually instead of a summary measure of wellbeing, we are able to differentiate better the affective reactions of travelers. Less is known about the values that travelers associate with modes _other_ than the one they use. For this reason, after developing a profile of the travelers who experience mode dissonance in the preceding section, we are now interested in the responses of travelers with respect to the modes they ideally tend to associate with various affective values. 
For this analysis we employ a visualization technique known as _faceting_. Bar charts are used to plot the proportions of respondents who associate each mode of transportation with an affective value. Faceting allows us to explore these proportions in a multivariate way by slicing the data according to additional attributes. The result is a visual representation of a multi-way contingency table. Please note that due to the small numbers of travelers who use modes categorized as "Other" we henceforth exclude them from the analysis.

We begin our investigation of the modes more frequently associated with different affective values by plotting the primary mode of travel and the modes associated with the values (see Figure \ref{fig:bar-plots-by-attribute}). We can think of the figure as a matrix of plots, with each dimension of the matrix a _facet_. In this figure, the columns of the matrix of plots correspond to different affective values, and the rows to different modes of primary mode of transportation, i.e., the mode actually used. The height of the bars in these plots is the proportion of respondents who selected mode $j = \text{Car, Active, Public}$ as embodying the corresponding affective value. 

We know from the preceding analysis (Table \ref{tab:cross-tabulation-results}) that users of public transportation tend to experience dissonance with significantly higher frequency than car users and active travelers. But which mode(s) would align better to their expectations with regards to the affective values under study? If we inspect the bottom row of plots, we see that public transport users most of the time associate Freedom, Enjoyment, and Happiness with active travel. Users of public transportation are more or less equally split in terms of associating Poverty with active travel and public transportation, whereas they overwhelmingly associate Luxury and Status with the private car.   

Active travelers rarely experience dissonance with respect to Freedom, Enjoyment, and Happiness. And although the experience of dissonance is more frequent with respect to Luxury and Status, there is still a sizable plurality of active travelers who associate these two affective values with active travel, _not_ the car (contrast these to the responses of public transit users.)

Interestingly, dissonance among car users with respect to Freedom, Enjoyment, and Happiness is relatively high. While car is still the most frequently chosen mode associated with Freedom among car users, the proportion of car users who identify Freedom with active travel is almost as high. And when it comes to Enjoyment and Happiness, car users experience significant dissonance and in fact a majority tend to indicate active travel as representing these two affective values. In contrast, car users display little dissonance with respect to feelings of Luxury and Status.

It is interesting to note that feelings of "Poverty" are associated with public transportation and active travel in almost exactly the same proportions, irrespective of the primary mode of travel.

Next, we further explore these responses after stratifying by age, education, income, and typical commute time. We test the underlying 3-way tables by means of the Cochran-Mantel-Haenszel $\chi^2$ test of independence, (the $p$-values of the tests are reported in the figures.) The next set of figures adds a facet to the columns, so that each affective value is now further divided into columns that correspond to the levels of an individual attribute (i.e., age, education, income, and typical commute time.)

```{r figure-mosaic-plots-by-attribute-with-instrumental, echo=FALSE, cache = TRUE, eval=FALSE, fig.cap="\\label{fig:mosaic-plots-by-attribute-with-instrumental}Mosaic plots for three affective and three instrumental values; values on the x-axis represent proportion of modes selected for each value, and values on the y-axis represent proportion of respondents by main mode of transportation"}

ggplot(data = Modes_by_Attribute) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode selected for the value of {Freedom, Enjoyment, Happiness, Safety, Time, Efficiency}") +
  ylab("Main mode of transportation") +
  scale_fill_viridis_d(direction = -1) +
  facet_wrap(~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-mosaic-plots-by-attribute, echo=FALSE, cache = TRUE, eval=FALSE, fig.cap="\\label{fig:mosaic-plots-by-attribute}Mosaic plots for affective values; the y-axis is the proportion of respondents by main mode of transportation, and the x-axis is the proportion of modes selected for each value"}

ggplot(data = Modes_by_Attribute %>% filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"))) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode associated with {Freedom, Enjoyment, Happiness, Poverty, Luxury, Status}") +
  ylab("Primary mode of travel") +
  scale_fill_viridis_d(direction = -1) +
  facet_wrap(~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-bar-plots-by-attribute, echo=FALSE, cache = TRUE,  fig.cap="\\label{fig:bar-plots-by-attribute}Plots for affective values; in the y-axis are the number of cases by primary mode of transportation, and in the x-axis are the modes selected for each affective value"}

Attribute_by_ideal <- Modes_by_Attribute %>% 
  drop_na() %>%
  filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"),
         USED != "Other", 
         IDEAL != "Other") %>%
  group_by(IDEAL, ATTRIBUTE, USED) %>%
  summarize(n= sum(WEIGHT),
            .groups = "drop") %>%
  ungroup() %>%
  # rename(MODE = IDEAL) %>%
  mutate(ATTRIBUTE = factor(ATTRIBUTE,
                            level = c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS")),
         CASE = "IDEAL",
         USED = factor(USED, 
                       levels = c("Car", "Active", "Public"),
                       labels = c("Used: Car", "Used: Active", "Used: Public")))

Attribute_by_used <- Attribute_by_ideal %>%
  group_by(USED, ATTRIBUTE) %>%
  summarize(t = sum(n),
            .groups = "drop")

Attribute_by_ideal <- Attribute_by_ideal %>%
  left_join(Attribute_by_used, 
            by = c("USED" = "USED", 
                   "ATTRIBUTE" = "ATTRIBUTE")) %>% 
  mutate(p = n/t)

Attribute_by_ideal_by_mode <- ggplot(data = Attribute_by_ideal,
       aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col() +
  facet_grid(USED ~ ATTRIBUTE) +
  #xlab("Modes associated with affective values") +
  scale_y_continuous(name = "Proportion", 
                     breaks = c(0, 0.5, 1), 
                     limits = c(0, 1)) +
  theme_tufte() +
  theme(axis.text.x = element_blank(),
        legend.position = "bottom",
        panel.border = element_rect(color = "black", fill = NA),
        axis.title.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.title = element_blank())

grid.arrange(Attribute_by_ideal_by_mode, 
             textGrob("Primary Mode of Travel",
                      rot = 270,
                      gp = gpar(fontsize = 11),
                      y = 0.6),
             widths = c(10, 0.5),
             ncol = 2,
             top = "Affective Values",
             bottom = "Modes Associated with Affective Values")
```

### Age

We find some interesting differences when exploring dissonance from the perspective of age of the travelers (see Figure \ref{fig:bar-plots-by-age}). For example, as seen in the preceding section, active travel is commonly associated with Freedom, Happiness, and Enjoyment, even by car users, but especially by users of public transportation. However, when we break this down by age, we notice that this tendency weakens as people age, and older travelers increasingly assign these affective values to the car. Furthermore, the tendency to associate Status with the car tends to increase with age. In contrast, the car loses in the value of Luxury with age among car and public transport users, but gains among active travelers after dropping among mid-aged respondents. Older travelers almost universally associate Status with the car.

```{r tests-by-attribute-and-age, echo=FALSE, cache = TRUE}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Freedom
Modes_by_Freedom_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "FREEDOM",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Enjoyment
Modes_by_Enjoyment_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "ENJOYMENT",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Happiness
Modes_by_Happiness_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "HAPPINESS",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Poverty (p = 0.9702)
Modes_by_Poverty_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "POVERTY",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Luxury
Modes_by_Luxury_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY",
                                                              USED != "Other", 
                                                              IDEAL != "Other"), 
                                                drop.unused.levels = TRUE))

# Status
Modes_by_Status_by_Age <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + AGE, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS",
                                                              USED != "Other", 
                                                              IDEAL != "Other"),
                                                drop.unused.levels = TRUE))
```

```{r figure-mosaic-plots-by-attribute-and-age, echo=FALSE, cache = TRUE, eval=FALSE, fig.cap="\\label{fig:mosaic-plots-by-age}Mosaic plots for affective values by age; the y-axis is the proportion of respondents by main mode of transportation, and the x-axis is the proportion of modes selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

ggplot(data = Modes_by_Attribute %>% 
         filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "LUXURY", "STATUS")) %>%
         mutate(ATTRIBUTE = factor(ATTRIBUTE, 
                                   levels = c("FREEDOM", "ENJOYMENT", "HAPPINESS", "LUXURY", "STATUS"),
                                   labels = labels))) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode associated with {Freedom, Enjoyment, Happiness, Luxury, Status}") +
  ylab("Primary mode of travel") +
  scale_fill_viridis_d(direction = -1) +
  facet_grid(AGE ~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-bar-plots-by-attribute-and-age, echo=FALSE, cache = TRUE, fig.cap="\\label{fig:bar-plots-by-age}Plots for affective values by age; in the y-axis is the proportion in the interval [0, 1], and the x-axis is the mode selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}
Attribute_by_ideal_by_age <- Modes_by_Attribute %>% 
  drop_na() %>%
  filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"),
         USED != "Other", 
         IDEAL != "Other") %>%
  group_by(IDEAL, ATTRIBUTE, AGE, USED) %>%
  summarize(n= sum(WEIGHT),
            .groups = "drop") %>%
  ungroup() %>%
  # rename(MODE = IDEAL) %>%
  mutate(CASE = "IDEAL",
         USED = factor(USED, 
                       levels = c("Car", "Active", "Public", "Other"),
                       labels = c("USED: CAR", "USED: ACTIVE", "USED: PUBLIC", "USED: OTHER")))

Attribute_by_ideal <- Attribute_by_ideal_by_age %>%
  group_by(USED, ATTRIBUTE, AGE) %>%
  summarize(t = sum(n),
            .groups = "drop")

Attribute_by_ideal_by_age <- Attribute_by_ideal_by_age %>%
  left_join(Attribute_by_ideal, 
            by = c("USED" = "USED", 
                   "ATTRIBUTE" = "ATTRIBUTE", 
                   "AGE" = "AGE")) %>% 
  mutate(p = n/t)

Freedom_by_age <- ggplot(data = Attribute_by_ideal_by_age  %>% 
                           filter(ATTRIBUTE %in% c("FREEDOM"),
                                  USED != "USED: OTHER", 
                                  IDEAL != "Other"),
                         aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ AGE, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x = element_blank(),
        legend.title = element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Enjoyment_by_age <- ggplot(data = Attribute_by_ideal_by_age  %>% 
                             filter(ATTRIBUTE %in% c("ENJOYMENT"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ AGE, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Happiness_by_age <- ggplot(data = Attribute_by_ideal_by_age  %>% 
                             filter(ATTRIBUTE %in% c("HAPPINESS"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ AGE, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Luxury_by_age <- ggplot(data = Attribute_by_ideal_by_age  %>% 
                          filter(ATTRIBUTE %in% c("LUXURY"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ AGE, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Status_by_age <- ggplot(data = Attribute_by_ideal_by_age  %>% 
                          filter(ATTRIBUTE %in% c("STATUS"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ AGE, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(Freedom_by_age)

lay <- rbind(c(1, 2, 3, 4, 5, NA),
             c(6, 7, 8, 9, 10, 11),
             c(6, 7, 8, 9, 10, 12),
             c(6, 7, 8, 9, 10, 13),
             c(14, 14, 14, 14, 14, NA))

grid.arrange(textGrob(paste('FREEDOM\np-value', 
                            ifelse(round(Modes_by_Freedom_by_Age$p.value, 2) >= 0.001,
                                   paste("=", round(Modes_by_Freedom_by_Age$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('ENJOYMENT\np-value', 
                            ifelse(round(Modes_by_Enjoyment_by_Age$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Enjoyment_by_Age$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('HAPPINESS\np-value', 
                            ifelse(round(Modes_by_Happiness_by_Age$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Happiness_by_Age$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('LUXURY\np-value', 
                            ifelse(round(Modes_by_Luxury_by_Age$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Luxury_by_Age$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Age$p.value, 3) >= 0.001,
                                                      paste("=", round(Modes_by_Status_by_Age$p.value, 3)),
                                                      " < 0.001")),
                      gp = gpar(fontsize = 9)),
             Freedom_by_age + theme(legend.position="none", 
                                    strip.text.x = element_text(angle = 90),
                                    strip.text.y = element_blank(),
                                    axis.title.y = element_blank(),
                                    axis.text.y = element_blank(),
                                    axis.ticks.y = element_blank(),
                                    axis.text.x = element_blank(),
                                    axis.ticks.x = element_blank()),
             Enjoyment_by_age + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y = element_blank(),
                                      axis.text.y = element_blank(),
                                      axis.ticks.y = element_blank(),
                                    axis.text.x = element_blank(),
                                    axis.ticks.x =element_blank()),
             Happiness_by_age + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y = element_blank(),
                                      axis.text.y = element_blank(),
                                      axis.ticks.y = element_blank(),
                                    axis.text.x = element_blank(),
                                    axis.ticks.x = element_blank()),
             Luxury_by_age + theme(legend.position="none", 
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y = element_blank(),
                                   axis.text.y = element_blank(),
                                   axis.ticks.y = element_blank(),
                                    axis.text.x = element_blank(),
                                    axis.ticks.x = element_blank()),
             Status_by_age + theme(legend.position="none",
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y = element_blank(),
                                   axis.text.y = element_blank(),
                                   axis.ticks.y = element_blank(),
                                    axis.text.x = element_blank(),
                                    axis.ticks.x = element_blank()),
             textGrob("Used: Car",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.1),
             textGrob("Used: Active",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.3),
             textGrob("Used: Public",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.4),
             mylegend, 
             layout_matrix = lay,
             heights = c(1, 3, 3, 3, 1),
             widths = c(3, 3, 3, 3, 3, 0.5),
             left = "Proportion",
             right = "Primary Mode of Travel",
             top = "Affective Values by Age",
             bottom = "Modes Associated with Affective Values")
```

### Education

Significant differences in dissonance by education are detected for five affective values. As seen in Figure \ref{fig:bar-plots-by-education}, the association between active travel and Freedom is weaker among car travelers who are less educated (i.e., education K-12). Feelings of enjoyment are more frequently associated with active travel, and more so for less educated (K-12) and highly educated (graduate) car users and active travelers. This is somewhat different among users of public transportation, a majority of whom still assign feelings of Freedom to active travel, but with a higher proportion of travelers who associate this affective value to the car, especially among highly educated individuals. Less educated travelers who use the car are less likely to associate the value of Happiness to active travel, and this changes among people with higher levels of academic achievement, for whom active travel more frequently evokes feelings of Happiness. As before, most respondents identify the car with the values of Luxury and Status, and in general, people with lower education declare positive associations with the car more frequently. The exception is Status among active travelers: the more highly educated the traveler, the lower the probability of dissonance with respect to this affective value.

```{r tests-by-attribute-and-education, echo=FALSE, cache = TRUE}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Freedom
Modes_by_Freedom_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "FREEDOM",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Enjoyment
Modes_by_Enjoyment_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "ENJOYMENT",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Happiness
Modes_by_Happiness_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "HAPPINESS",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Poverty (p = 0.827)
Modes_by_Poverty_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "POVERTY",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Luxury
Modes_by_Luxury_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY",
                                                              USED != "Other", 
                                                              IDEAL != "Other"), 
                                                drop.unused.levels = TRUE))

# Status
Modes_by_Status_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS",
                                                              USED != "Other", 
                                                              IDEAL != "Other"),
                                                drop.unused.levels = TRUE))
```

```{r figure-mosaic-plots-by-attribute-and-education, echo=FALSE, cache = TRUE, eval=FALSE, fig.width= 6, fig.height=5, fig.cap="\\label{fig:mosaic-plots-by-education}Mosaic plots for affective values by education; the y-axis is the proportion of respondents by main mode of transportation, and the x-axis is the proportion of modes selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Luxury
Modes_by_Luxury_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY")))

# Status
Modes_by_Status_by_Education <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + EDUCATION, data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS")))

labels <- c(paste('LUXURY\np-value', ifelse(round(Modes_by_Luxury_by_Education$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Luxury_by_Education$p.value, 3)),
                                            " < 0.001")),
            paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Education$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Status_by_Education$p.value, 3)),
                                            " < 0.001")))


ggplot(data = Modes_by_Attribute %>% 
         filter(ATTRIBUTE %in% c("LUXURY", "STATUS")) %>%
         mutate(ATTRIBUTE = factor(ATTRIBUTE,
                                   levels = c("LUXURY", "STATUS"),
                                   labels = labels))) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode associated with {Luxury, Status}") +
  ylab("Primary mode of travel") +
  scale_fill_viridis_d(direction = -1) +
  facet_grid(EDUCATION ~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-bar-plots-by-attribute-and-education, echo=FALSE, cache = TRUE, fig.cap="\\label{fig:bar-plots-by-education}Plots for affective values by level of education; in the y-axis is the proportion in the interval [0, 1], and the x-axis is the mode selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

Attribute_by_ideal_by_education <- Modes_by_Attribute %>% 
  drop_na() %>%
  filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"),
         USED != "Other", 
         IDEAL != "Other") %>%
  group_by(IDEAL, ATTRIBUTE, EDUCATION, USED) %>%
  summarize(n= sum(WEIGHT),
            .groups = "drop") %>%
  ungroup() %>%
  # rename(MODE = IDEAL) %>%
  mutate(CASE = "IDEAL",
         USED = factor(USED, 
                       levels = c("Car", "Active", "Public", "Other"),
                       labels = c("USED: CAR", "USED: ACTIVE", "USED: PUBLIC", "USED: OTHER")))

Attribute_by_ideal <- Attribute_by_ideal_by_education %>%
  group_by(USED, ATTRIBUTE, EDUCATION) %>%
  summarize(t = sum(n),
            .groups = "drop")

Attribute_by_ideal_by_education <- Attribute_by_ideal_by_education %>%
  left_join(Attribute_by_ideal, 
            by = c("USED" = "USED", 
                   "ATTRIBUTE" = "ATTRIBUTE", 
                   "EDUCATION" = "EDUCATION")) %>% 
  mutate(p = n/t)

Freedom_by_education <- ggplot(data = Attribute_by_ideal_by_education  %>% 
                           filter(ATTRIBUTE %in% c("FREEDOM"),
                                  USED != "USED: OTHER", 
                                  IDEAL != "Other"),
                         aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ EDUCATION, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        legend.title = element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Enjoyment_by_education <- ggplot(data = Attribute_by_ideal_by_education  %>% 
                             filter(ATTRIBUTE %in% c("ENJOYMENT"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ EDUCATION, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Happiness_by_education <- ggplot(data = Attribute_by_ideal_by_education  %>% 
                             filter(ATTRIBUTE %in% c("HAPPINESS"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ EDUCATION, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Luxury_by_education <- ggplot(data = Attribute_by_ideal_by_education  %>% 
                          filter(ATTRIBUTE %in% c("LUXURY"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ EDUCATION, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Status_by_education <- ggplot(data = Attribute_by_ideal_by_education  %>% 
                          filter(ATTRIBUTE %in% c("STATUS"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ EDUCATION, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(Freedom_by_education)

lay <- rbind(c(1, 2, 3, 4, 5, NA),
             c(6, 7, 8, 9, 10, 11),
             c(6, 7, 8, 9, 10, 12),
             c(6, 7, 8, 9, 10, 13),
             c(14, 14, 14, 14, 14, NA))

grid.arrange(textGrob(paste('FREEDOM\np-value', 
                            ifelse(round(Modes_by_Freedom_by_Education$p.value, 2) >= 0.001,
                                   paste("=", round(Modes_by_Freedom_by_Education$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('ENJOYMENT\np-value', 
                            ifelse(round(Modes_by_Enjoyment_by_Education$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Enjoyment_by_Education$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('HAPPINESS\np-value', 
                            ifelse(round(Modes_by_Happiness_by_Education$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Happiness_by_Education$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('LUXURY\np-value', 
                            ifelse(round(Modes_by_Luxury_by_Education$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Luxury_by_Education$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Education$p.value, 3) >= 0.001,
                                                      paste("=", round(Modes_by_Status_by_Education$p.value, 3)),
                                                      " < 0.001")),
                      gp = gpar(fontsize = 9)),
             Freedom_by_education + theme(legend.position="none", 
                                    strip.text.x = element_text(angle = 90),
                                    strip.text.y = element_blank(),
                                    axis.title.y = element_blank(),
                                    axis.text.y = element_blank(),
                                    axis.ticks.y = element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Enjoyment_by_education + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y = element_blank(),
                                      axis.text.y = element_blank(),
                                      axis.ticks.y = element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Happiness_by_education + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y = element_blank(),
                                      axis.text.y = element_blank(),
                                      axis.ticks.y = element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Luxury_by_education + theme(legend.position="none", 
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y = element_blank(),
                                   axis.text.y = element_blank(),
                                   axis.ticks.y = element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Status_by_education + theme(legend.position="none",
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y = element_blank(),
                                   axis.text.y = element_blank(),
                                   axis.ticks.y = element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             textGrob("Used: Car",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.0),
             textGrob("Used: Active",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.2),
             textGrob("Used: Public",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.4),
             mylegend, 
             layout_matrix = lay,
             #nrow=3,
             #widths = c(2.4, 1.9, 1.9, 1.9, 1.9), 
             heights = c(1, 3, 3, 3, 1),
             widths = c(3, 3, 3, 3, 3, 0.5),
             left = "Proportion",
             right = "Primary Mode of Travel",
             top = "Affective Values by Education",
             bottom = "Modes Associated with Affective Values")
```

### Income

Like with education, there are significant differences in dissonance by income for five affective values. As seen in Figure \ref{fig:bar-plots-by-income}, car users with lower incomes tend to associate Freedom and Enjoyment with active travel, but more with respect to Enjoyment. In contrast, Enjoyment is more frequently associated with active travel among more affluent car users. Active travelers seldom experience dissonance with respect to Freedom, Enjoyment, and Happiness, irrespective of income level. However, although public transport users still tend to link active travel with feelings of Freedom, Enjoyment, and Happiness, they remain more likely to attribute these values to the car.

Interestingly, despite lower income individuals experiencing dissonance more frequently with respect to feelings of Poverty, we do not find that those feelings are specific to a transportation mode. In contrast, we see again that Luxury and Status generally are almost always attributed to the car, but with some interesting differences by income and primary mode of travel. Indeed, higher income active travelers, although still more likely to associate Luxury and Status with the car, are more likely than users of other modes to associate these affects to active travel, perhaps due to an awareness of the benefits of walking and using the bicycle. Furthermore, high-income users of cars are more likely to experience consonance with respect to status and luxury, in what might be a form of self-congratulatory confirmation of success.

```{r tests-by-attribute-and-income, echo=FALSE, cache = TRUE}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Freedom
Modes_by_Freedom_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "FREEDOM",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Enjoyment
Modes_by_Enjoyment_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "ENJOYMENT",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Happiness
Modes_by_Happiness_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "HAPPINESS",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Poverty (p = 0.8752)
Modes_by_Poverty_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "POVERTY",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Luxury
Modes_by_Luxury_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY",
                                                              USED != "Other", 
                                                              IDEAL != "Other"), 
                                                drop.unused.levels = TRUE))

# Status
Modes_by_Status_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS",
                                                              USED != "Other", 
                                                              IDEAL != "Other"),
                                                drop.unused.levels = TRUE))
```

```{r figure-mosaic-plots-by-attribute-and-income, echo=FALSE, cache = TRUE, eval=FALSE, fig.width= 7, fig.height=5, fig.cap="\\label{fig:mosaic-plots-by-income}Mosaic plots for affective values by income; the y-axis is the proportion of respondents by main mode of transportation, and the x-axis is the proportion of modes selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Poverty
Modes_by_Poverty_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, data = filter(Modes_by_Attribute, ATTRIBUTE == "POVERTY")))

# Luxury
Modes_by_Luxury_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY")))

# Status
Modes_by_Status_by_Income <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + INCOME, data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS")))

labels <- c(paste('POVERTY\np-value', ifelse(round(Modes_by_Poverty_by_Income$p.value, 3) >= 0.001,
                                             paste("=", round(Modes_by_Poverty_by_Income$p.value, 3)),
                                             " < 0.001")),
            paste('LUXURY\np-value', ifelse(round(Modes_by_Luxury_by_Income$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Luxury_by_Income$p.value, 3)),
                                            " < 0.001")),
            paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Income$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Status_by_Income$p.value, 3)),
                                            " < 0.001")))


ggplot(data = Modes_by_Attribute %>% 
         filter(ATTRIBUTE %in% c("POVERTY", "LUXURY", "STATUS")) %>%
         mutate(ATTRIBUTE = factor(ATTRIBUTE, 
                                   levels = c("POVERTY", "LUXURY", "STATUS"),
                                   labels = labels))) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode associated with {Poverty, Luxury, Status}") +
  ylab("Primary mode of travel") +
  scale_fill_viridis_d(direction = -1) +
  facet_grid(INCOME ~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-bar-plots-by-attribute-and-income, echo=FALSE, cache = TRUE, fig.cap="\\label{fig:bar-plots-by-income}Plots for affective values by level of income; in the y-axis is the proportion in the interval [0, 1], and the x-axis is the mode selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

Attribute_by_ideal_by_income <- Modes_by_Attribute %>% 
  drop_na() %>%
  filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"),
         USED != "Other", 
         IDEAL != "Other") %>%
  group_by(IDEAL, ATTRIBUTE, INCOME, USED) %>%
  summarize(n= sum(WEIGHT),
            .groups = "drop") %>%
  ungroup() %>%
  # rename(MODE = IDEAL) %>%
  mutate(CASE = "IDEAL",
         USED = factor(USED, 
                       levels = c("Car", "Active", "Public", "Other"),
                       labels = c("USED: CAR", "USED: ACTIVE", "USED: PUBLIC", "USED: OTHER")))

Attribute_by_ideal <- Attribute_by_ideal_by_income %>%
  group_by(USED, ATTRIBUTE, INCOME) %>%
  summarize(t = sum(n),
            .groups = "drop")

Attribute_by_ideal_by_income <- Attribute_by_ideal_by_income %>%
  left_join(Attribute_by_ideal, 
            by = c("USED" = "USED", 
                   "ATTRIBUTE" = "ATTRIBUTE", 
                   "INCOME" = "INCOME")) %>% 
  mutate(p = n/t)

Freedom_by_income <- ggplot(data = Attribute_by_ideal_by_income  %>% 
                           filter(ATTRIBUTE %in% c("FREEDOM"),
                                  USED != "USED: OTHER", 
                                  IDEAL != "Other"),
                         aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ INCOME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        legend.title = element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Enjoyment_by_income <- ggplot(data = Attribute_by_ideal_by_income  %>% 
                             filter(ATTRIBUTE %in% c("ENJOYMENT"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ INCOME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Happiness_by_income <- ggplot(data = Attribute_by_ideal_by_income  %>% 
                             filter(ATTRIBUTE %in% c("HAPPINESS"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ INCOME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Luxury_by_income <- ggplot(data = Attribute_by_ideal_by_income  %>% 
                          filter(ATTRIBUTE %in% c("LUXURY"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ INCOME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Status_by_income <- ggplot(data = Attribute_by_ideal_by_income  %>% 
                          filter(ATTRIBUTE %in% c("STATUS"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ INCOME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(Freedom_by_income)

lay <- rbind(c(1, 2, 3, 4, 5, NA),
             c(6, 7, 8, 9, 10, 11),
             c(6, 7, 8, 9, 10, 12),
             c(6, 7, 8, 9, 10, 13),
             c(14, 14, 14, 14, 14, NA))

grid.arrange(textGrob(paste('FREEDOM\np-value', 
                            ifelse(round(Modes_by_Freedom_by_Income$p.value, 2) >= 0.001,
                                   paste("=", round(Modes_by_Freedom_by_Income$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('ENJOYMENT\np-value', 
                            ifelse(round(Modes_by_Enjoyment_by_Income$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Enjoyment_by_Income$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('HAPPINESS\np-value', 
                            ifelse(round(Modes_by_Happiness_by_Income$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Happiness_by_Income$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('LUXURY\np-value', 
                            ifelse(round(Modes_by_Luxury_by_Income$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Luxury_by_Income$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Income$p.value, 3) >= 0.001,
                                                      paste("=", round(Modes_by_Status_by_Income$p.value, 3)),
                                                      " < 0.001")),
                      gp = gpar(fontsize = 9)),
             Freedom_by_income + theme(legend.position="none", 
                                    strip.text.x = element_text(angle = 90),
                                    strip.text.y = element_blank(),
                                    axis.title.y=element_blank(),
                                    axis.text.y=element_blank(),
                                    axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Enjoyment_by_income + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y=element_blank(),
                                      axis.text.y=element_blank(),
                                      axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Happiness_by_income + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y=element_blank(),
                                      axis.text.y=element_blank(),
                                      axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Luxury_by_income + theme(legend.position="none", 
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y=element_blank(),
                                   axis.text.y=element_blank(),
                                   axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Status_by_income + theme(legend.position="none",
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y=element_blank(),
                                   axis.text.y=element_blank(),
                                   axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             textGrob("Used: Car",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.1),
             textGrob("Used: Active",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.3),
             textGrob("Used: Public",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.4),
             mylegend, 
             layout_matrix = lay,
             #nrow=3,
             #widths = c(2.4, 1.9, 1.9, 1.9, 1.9), 
             heights = c(1, 3, 3, 3, 1),
             widths = c(3, 3, 3, 3, 3, 0.5),
             left = "Proportion",
             right = "Primary Mode of Travel",
             top = "Affective Values by Income",
             bottom = "Modes Associated with Affective Values")
```

### Typical commute time

The last dimension of dissonance that we examine is typical commute time. Four affective values are significant along this dimension, namely Freedom, Enjoyment, Happiness, and Status. Figure \ref{fig:bar-plots-by-travel-time} shows the way travelers associate different affective values to modes of transportation by length of typical commute.

Among car users, Freedom is associated with the car in all but the longest commutes (>60 min), in which case active travel is more frequently identified as the mode that evokes feelings of Freedom. The associations of active travel with Enjoyment  and Happiness are consistently high among car users, although car becomes more frequently associated with this value for longer commutes. As we have seen before, active travelers seldom experience dissonance with respect to Freedom, Enjoyment, and Happiness, and if anything the strength of this association increases with longer commutes. Public transportation users again are split in their preference towards active travel and car as the modes more likely to evoke feelings of Freedom, Enjoyment, and Happiness, and there are only relatively minor differences in these preferences by length of commute. The last affective value that displays significant differences in dissonance by length of typical commute is Status. The car tends to dominate as the mode more frequently associated with this value among car and public transportation users. Active travelers, on the other hand, associate status more strongly with short or very long commutes: only when commutes are shorter than 20 minutes or longer than 60 minutes do active travelers associate feelings of Status with the car.

```{r tests-by-attribute-and-travel-time, echo=FALSE, cache = TRUE}

# Select only values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Freedom
Modes_by_Freedom_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "FREEDOM",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Enjoyment
Modes_by_Enjoyment_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "ENJOYMENT",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Happiness
Modes_by_Happiness_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                   data = filter(Modes_by_Attribute, ATTRIBUTE == "HAPPINESS",
                                                                 USED != "Other", 
                                                                 IDEAL != "Other"), 
                                                   drop.unused.levels = TRUE))

# Poverty (p = 0.6087)
Modes_by_Poverty_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                 data = filter(Modes_by_Attribute, ATTRIBUTE == "POVERTY",
                                                               USED != "Other", 
                                                               IDEAL != "Other"), 
                                                 drop.unused.levels = TRUE))

# Luxury (p = 0.5685)
Modes_by_Luxury_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY",
                                                              USED != "Other", 
                                                              IDEAL != "Other"), 
                                                drop.unused.levels = TRUE))

# Status
Modes_by_Status_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, 
                                                data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS",
                                                              USED != "Other", 
                                                              IDEAL != "Other"),
                                                drop.unused.levels = TRUE))
```

```{r figure-mosaic-plots-by-attribute-and-time, echo=FALSE, cache = TRUE, eval=FALSE,  fig.cap="\\label{fig:mosaic-plots-by-travel-time}Mosaic plots for affective values by commute time; the y-axis is the proportion of respondents by main mode of transportation, and the x-axis is the proportion of modes selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

# Select only affective values that were significant in the tests of independence

# Also, use Cochran-Mantel-Haenzel tests
# Freedom
Modes_by_Freedom_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, data = filter(Modes_by_Attribute, ATTRIBUTE == "FREEDOM")))

# Happiness
Modes_by_Happiness_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, data = filter(Modes_by_Attribute, ATTRIBUTE == "HAPPINESS")))

# Luxury
Modes_by_Luxury_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, data = filter(Modes_by_Attribute, ATTRIBUTE == "LUXURY")))

# Status
Modes_by_Status_by_Time <- mantelhaen.test(xtabs(WEIGHT ~ USED + IDEAL + TRAVEL_TIME, data = filter(Modes_by_Attribute, ATTRIBUTE == "STATUS")))

labels <- c(paste('FREEDOM\np-value', ifelse(round(Modes_by_Freedom_by_Time$p.value, 2) >= 0.001,
                                             paste("=", round(Modes_by_Freedom_by_Time$p.value, 3)),
                                             " < 0.001")),
            paste('ENJOYMENT\np-value', ifelse(round(Modes_by_Freedom_by_Time$p.value, 3) >= 0.001,
                                               paste("=", round(Modes_by_Freedom_by_Time$p.value, 3)),
                                               " < 0.001")),
            paste('LUXURY\np-value', ifelse(round(Modes_by_Freedom_by_Time$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Freedom_by_Time$p.value, 3)),
                                            " < 0.001")),
            paste('STATUS\np-value', ifelse(round(Modes_by_Freedom_by_Time$p.value, 3) >= 0.001,
                                            paste("=", round(Modes_by_Freedom_by_Time$p.value, 3)),
                                            " < 0.001")))



ggplot(data = Modes_by_Attribute %>% 
         filter(ATTRIBUTE %in% c("FREEDOM", "HAPPINESS", "LUXURY", "STATUS")) %>% drop_na(TRAVEL_TIME) %>%
         mutate(ATTRIBUTE = factor(ATTRIBUTE, 
                                   levels = c("FREEDOM", "HAPPINESS", "LUXURY", "STATUS"),
                                   labels = labels))) + 
  geom_mosaic(aes(product(IDEAL, USED), fill = IDEAL, weight = WEIGHT),
              divider = mosaic("vertical")) + 
  xlab("Mode associated with {Freedom, Happiness, Luxury, Status}") +
  ylab("Primary mode of travel") +
  scale_fill_viridis_d(direction = -1) +
  facet_grid(TRAVEL_TIME ~ ATTRIBUTE) +
  theme_tufte() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r figure-bar-plots-by-attribute-and-travel-time, echo=FALSE, cache = TRUE, fig.cap="\\label{fig:bar-plots-by-travel-time}Plots for affective values by commute time; in the y-axis is the proportion in the interval [0, 1], and the x-axis is the mode selected for each value (p-values are for Cochran-Mantel-Haenszel Chi-Squared Test)"}

Attribute_by_ideal_by_time <- Modes_by_Attribute %>% 
  drop_na() %>%
  filter(ATTRIBUTE %in% c("FREEDOM", "ENJOYMENT", "HAPPINESS", "POVERTY", "LUXURY", "STATUS"),
         USED != "Other", 
         IDEAL != "Other") %>%
  group_by(IDEAL, ATTRIBUTE, TRAVEL_TIME, USED) %>%
  summarize(n= sum(WEIGHT),
            .groups = "drop") %>%
  ungroup() %>%
  # rename(MODE = IDEAL) %>%
  mutate(CASE = "IDEAL",
         USED = factor(USED, 
                       levels = c("Car", "Active", "Public", "Other"),
                       labels = c("USED: CAR", "USED: ACTIVE", "USED: PUBLIC", "USED: OTHER")))

Attribute_by_ideal <- Attribute_by_ideal_by_time %>%
  group_by(USED, ATTRIBUTE, TRAVEL_TIME) %>%
  summarize(t = sum(n),
            .groups = "drop")

Attribute_by_ideal_by_time <- Attribute_by_ideal_by_time %>%
  left_join(Attribute_by_ideal, 
            by = c("USED" = "USED", 
                   "ATTRIBUTE" = "ATTRIBUTE", 
                   "TRAVEL_TIME" = "TRAVEL_TIME")) %>% 
  mutate(p = n/t)

Freedom_by_time <- ggplot(data = Attribute_by_ideal_by_time  %>% 
                           filter(ATTRIBUTE %in% c("FREEDOM"),
                                  USED != "USED: OTHER", 
                                  IDEAL != "Other"),
                         aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ TRAVEL_TIME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        legend.title = element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Enjoyment_by_time <- ggplot(data = Attribute_by_ideal_by_time  %>% 
                             filter(ATTRIBUTE %in% c("ENJOYMENT"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ TRAVEL_TIME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Happiness_by_time <- ggplot(data = Attribute_by_ideal_by_time  %>% 
                             filter(ATTRIBUTE %in% c("HAPPINESS"),
                                    USED != "USED: OTHER", 
                                    IDEAL != "Other"),
                           aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ TRAVEL_TIME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Luxury_by_time <- ggplot(data = Attribute_by_ideal_by_time  %>% 
                          filter(ATTRIBUTE %in% c("LUXURY"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ TRAVEL_TIME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

Status_by_time <- ggplot(data = Attribute_by_ideal_by_time  %>% 
                          filter(ATTRIBUTE %in% c("STATUS"),
                                 USED != "USED: OTHER", 
                                 IDEAL != "Other"),
                        aes(x = IDEAL, y = p, fill = IDEAL)) + 
  geom_col(position = "dodge") +
  facet_grid(USED ~ TRAVEL_TIME, shrink = TRUE) +
  xlab("Modes associated with affective values") +
  ylab("Number of cases") +
  theme_tufte() +
  theme(panel.border = element_rect(color = "black", fill = NA)) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        axis.title.x=element_blank(),
        panel.spacing = unit(0.1, "lines"),
        plot.margin = margin(0, 0, 0, 0, "cm")) 

#extract legend
#https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(Freedom_by_time)

lay <- rbind(c(1, 2, 3, 4, NA),
             c(6, 7, 8, 9, 11),
             c(6, 7, 8, 9, 12),
             c(6, 7, 8, 9, 13),
             c(14, 14, 14, 14, NA))

grid.arrange(textGrob(paste('FREEDOM\np-value', 
                            ifelse(round(Modes_by_Freedom_by_Time$p.value, 2) >= 0.001,
                                   paste("=", round(Modes_by_Freedom_by_Time$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('ENJOYMENT\np-value', 
                            ifelse(round(Modes_by_Enjoyment_by_Time$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Enjoyment_by_Time$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('HAPPINESS\np-value', 
                            ifelse(round(Modes_by_Happiness_by_Time$p.value, 3) >= 0.001,
                                   paste("=", round(Modes_by_Happiness_by_Time$p.value, 3)),
                                   " < 0.001")),
                      gp = gpar(fontsize = 9)),
             textGrob(paste('STATUS\np-value', ifelse(round(Modes_by_Status_by_Time$p.value, 3) >= 0.001,
                                                      paste("=", round(Modes_by_Status_by_Time$p.value, 3)),
                                                      " < 0.001")),
                      gp = gpar(fontsize = 9)),
             Freedom_by_time + theme(legend.position="none", 
                                    strip.text.x = element_text(angle = 90),
                                    strip.text.y = element_blank(),
                                    axis.title.y=element_blank(),
                                    axis.text.y=element_blank(),
                                    axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Enjoyment_by_time + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y=element_blank(),
                                      axis.text.y=element_blank(),
                                      axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Happiness_by_time + theme(legend.position="none", 
                                      strip.text.x = element_text(angle = 90),
                                      strip.text.y = element_blank(),
                                      axis.title.y=element_blank(),
                                      axis.text.y=element_blank(),
                                      axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             Status_by_time + theme(legend.position="none",
                                   strip.text.x = element_text(angle = 90),
                                   strip.text.y = element_blank(),
                                   axis.title.y=element_blank(),
                                   axis.text.y=element_blank(),
                                   axis.ticks.y=element_blank(),
                                   axis.text.x = element_blank(),
                                   axis.ticks.x = element_blank()),
             textGrob("Used: Car",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.0),
             textGrob("Used: Active",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.2),
             textGrob("Used: Public",
                      rot = 270,
                      gp = gpar(fontsize = 9),
                      y = 0.4),
             mylegend, 
             layout_matrix = lay,
             #nrow=3,
             #widths = c(2.4, 1.9, 1.9, 1.9, 1.9), 
             heights = c(1, 3, 3, 3, 1),
             widths = c(3, 3, 3, 3, 0.5),
             left = "Proportion",
             right = "Primary Mode of Travel",
             top = "Affective Values by Commute Time",
             bottom = "Modes Associated with Affective Values")
```

Summary and Concluding Remarks
==========

The topic of subjective wellbeing has attracted considerable attention in recent years due to its relationship with health. As the world tries to move from a culture dominated by a century-long love affair with the automobile, there is a pressing need to understand how travelers perceive different modes of transportation from the lens of subjective wellbeing. Insights in this regard could prove valuable to develop and implement plans and policies to attract and retain users to healthier, more environmentally friendly transportation options [@Chatterjee2019commuting]. For this reason, understanding mode dissonance, the extent to which the experience of travelers differs from their aspirations, is a worthwhile topic for research.

This paper contributes to the literature in three ways. 

First, the research contributes to an emerging literature on the topic of transportation and subjective wellbeing in the context of the Global South [@Alayyash2019commute; @Bejarano2017user; @Shao2019analysis; @Van2014effect; @Zorrilla2019exploring]; to the best of our knowledge, the case of Chile has not yet been reported. Second, although there is an extensive literature on the enjoyment of commute and other affective values [see for instance @Paez2010enjoyment; @Redmond2001positive; @Whalen2013mode; @Ye2017satisfaction], from a hedonic and even eudaimonic perspectives the analysis has yet to be applied more fully in terms of distributional issues – i.e. which groups more commonly experience dissonance [see @Devos2018people]. Third, the analysis shows the attitudes of people towards their primary mode and their perception towards ‘ideal modes’, complementing the studies based on affective factors on transit or active modes [@Bornioli2019affective; @Devos2017travel], satisfaction [@Devos2019satisfying], or quality [@Redman2013quality].

The premise of this study is that a key component of subjective wellbeing is the affective reaction to experience [see the definition of wellbeing offered by the OECD; -@oecd2013oecd]. In this paper we investigated mode dissonance from the perspective of six affective values. The research presented here was based on a sample of travelers in Santiago, the capital of Chile. Participants in this research were asked about their typical mode of travel, and then about the mode or modes that they associate with each of the six affective values. Analysis using hypothesis testing (tests of independence) and visualization techniques (bar charts with faceting) uncovered interesting patterns. Some of our findings are well aligned with previous research; for example, active travelers experience less dissonance than car users, and users of public transportation experience the most dissonance of all. However, by considering affective values separately instead of aggregating them into a single indicator of subjective wellbeing, we manage to preserve greater granularity with respect to various responses than most studies. This is important because hedonic/eudaimonic values are more frequently related to active travel (Freedom, Enjoyment, Happiness), while Poverty is more frequently related to public transportation and active travel. Luxury and Status, on the other hand, are more frequently associated to car.

Further delving into the question of which modes are associated with these affective values, we find that there are important differences in terms of the typical mode of travel. Active travelers experience dissonance with relatively little frequently with respect to Freedom, Enjoyment, and Happiness, but when they do, they tend to attach positive values to the car. Car users experience dissonance with respect to these affects more frequently than active travelers, and when they do, they strongly relate positive hedonic/eudaimonic values to active travel. In other words, it is possible that drivers dream of walking when it comes to feelings of Enjoyment and Happiness, and to a lesser extent Freedom. The other side of the coin is also interesting. When it comes to affective values with a stronger socio-economic flavor, such as Poverty, Luxury, and Status, car users tend to experience dissonance less frequently than users of other modes. Active travelers, although more resistant to the lure of the car compared to users of public transportation, also tend to attach values of Luxury and Status to the car when they experience dissonance.

An examination of these effects by age, level of education, level of income, and typical trip duration reveals some ways in which these trends become more pronounced. For instance, older people are less likely than younger people to associate active travel with positive hedonic/eudaimonic affects, and are more likely to attach these values to the car. People with higher incomes are more atuned to the luxury and status values of cars, whereas lower income people are more likely to relate active travel to luxury and status.

These results not only help to flesh out some ways in which mode dissonance could play out from the perspective of different affects, but does so in the context of a Latin American country, a region where deep-seated taboos with respect to different modes of transportation exist: the poor travel by public transportation and/or are forced active travelers; a country where the rich enjoy the luxury of private vehicles and/or are active travelers by choice. In this way, the paper helps us to reflect on the affective reaction of members of the public with respect to their transportation experience. A better understanding of these responses can in turn be used to judiciously enhance the experience of commuting, to increase the satisfaction of commuters, and to meet their preferences.

In  this respect, it is important to note that the perception of users has been considered mainly from the lens of trip satisfaction, but the more granular approach taken in this study offers some advantages. For example, understanding dissonances reveals that public transport users are clearly at a disadvantage (i.e., they experience dissonance more frequently) compared to other travelers. Furthermore, the results reveal that within public transport users, there are also important socio-economic differences. In contrast, users of cars do not necessarily associate hedonic/eudaimonic values to this mode, which suggests that not only these feelings could be leveraged to attract them to active modes, but could also as a result lead to gains in wellbeing.

With respect to opportunities for future research, a possible extension of the present research would be to investigate the use of the modes other than the typical mode of transportation. In a recent paper that investigated commute satisfaction for car users, Al-Ayyash and Abou-Zeid [-@Alayyash2019commute] considered three models: for current trip satisfaction, remembered satisfaction while using public transport, and current satisfaction using public transport. The findings suggest that low service quality in public transportation can result in a generalized negative perception, and that this perception is more difficult to smooth if commuters do not regularly use public transport. Another avenue for future research could be to consider the mix of modes typically used. While in this paper the analysis focused on the primary mode of transportation, many travelers experience more than one mode of transportation in their daily activities. For this reason, considering the multimodal component of travel would be interesting; for example, future research could consider people who eventually arrive by bicycle to the metro station or people that, after using a _colectivo_ for part of a trip, end their journey by bus.

Acknowledgments
==========

We wish to express our gratitude to Prof. Jonas De Vos and three anonymous reviewers for their feedback on an earlier version of this paper. Their suggestions helped to improve the quality of the research and the clarity of the presentation. The following `R` packages were used in the course of this investigation and the authors wish to acknowledge their developers: `ggmosaic` [@Jeppson2019ggmosaic], `ggthemes` [@Arnold2018], `kableExtra` [@Zhu2018], `knitr` [@Xie2015; @Xie2018], `rticles` [@Allaire2018rticles], and `tidyverse` [@Wickham2017].

References {#references .unnumbered}
==========

